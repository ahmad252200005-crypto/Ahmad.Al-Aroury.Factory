<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المصنع المتكامل - مصنع أحمد العاروري</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* جميع الأنماط كما هي دون تغيير */
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #f39c12);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            position: relative;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100px;
            height: 3px;
            background: #3498db;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #3498db;
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .dashboard-card i {
            font-size: 30px;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .dashboard-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .dashboard-card .label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-left: 5px;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }
        
        .invoice-info div, .company-info div {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .client-info {
            background: linear-gradient(to right, #f9f9f9, #eef2f7);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-right: 4px solid #3498db;
        }
        
        .client-info h3 {
            margin-top: 0;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
        }
        
        .client-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        th, td {
            padding: 14px 12px;
            text-align: center;
            border-bottom: 1px solid #e1e1e1;
        }
        
        th {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #eef7ff;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: linear-gradient(to bottom, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
        }
        
        .btn-danger:hover {
            background: linear-gradient(to bottom, #c0392b, #a53125);
        }
        
        .btn-success {
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
        }
        
        .btn-success:hover {
            background: linear-gradient(to bottom, #27ae60, #219653);
        }
        
        .btn-secondary {
            background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to bottom, #7f8c8d, #6c7b7d);
        }
        
        .btn-warning {
            background: linear-gradient(to bottom, #f39c12, #e67e22);
        }
        
        .btn-warning:hover {
            background: linear-gradient(to bottom, #e67e22, #d35400);
        }
        
        .btn-info {
            background: linear-gradient(to bottom, #17a2b8, #138496);
        }
        
        .btn-info:hover {
            background: linear-gradient(to bottom, #138496, #117a8b);
        }
        
        .total-section {
            text-align: left;
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 8px;
            border: 1px solid #e1e1e1;
        }
        
        .total-section div {
            margin-bottom: 12px;
            font-size: 17px;
            display: flex;
            justify-content: space-between;
        }
        
        .grand-total {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            border-top: 2px solid #ddd;
            padding-top: 15px;
            margin-top: 10px;
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .actions .btn {
            flex: 1;
            min-width: 150px;
            margin: 5px;
        }
        
        .product-select {
            position: relative;
        }
        
        .product-select select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: left 12px center;
            background-size: 16px;
            padding-left: 40px;
        }
        
        .remove-product {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .payment-section {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e1e1e1;
        }
        
        .payment-methods {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .payment-method {
            flex: 1;
            min-width: 120px;
        }
        
        .payment-method input {
            display: none;
        }
        
        .payment-method label {
            display: block;
            padding: 12px;
            text-align: center;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-method input:checked + label {
            border-color: #3498db;
            background: #e3f2fd;
            color: #3498db;
            font-weight: bold;
        }
        
        .remaining-balance {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        
        .client-balance {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
            margin: 15px 0;
        }
        
        .autocomplete {
            position: relative;
        }
        
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #d4d4d4;
        }
        
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
        
        .autocomplete-active {
            background-color: #3498db !important;
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #2ecc71;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
        
        .client-invoices {
            margin-top: 20px;
        }
        
        .invoice-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        .invoice-header-small {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .payment-form {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c8e6c9;
        }
        
        .balance-positive {
            color: #27ae60;
            font-weight: bold;
        }
        
        .balance-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        /* ترويسة الطباعة */
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 3px double #000;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
        }
        
        .print-header h1 {
            font-size: 32px;
            margin: 0;
            color: #2c3e50;
            border: none;
            padding: 0;
        }
        
        .print-header h2 {
            font-size: 24px;
            margin: 10px 0;
            color: #34495e;
        }
        
        .print-header .english-title {
            font-size: 20px;
            color: #7f8c8d;
            margin: 5px 0;
            font-weight: normal;
        }

        /* أنماط جديدة للدفعات المتعددة */
        .multiple-payments {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
        }
        
        .payment-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .payment-row input, .payment-row select {
            flex: 1;
        }
        
        .payment-summary {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        /* نافذة تأكيد الحذف */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .modal h3 {
            margin-top: 0;
            color: #e74c3c;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* التقارير */
        .reports-section {
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #90caf9;
        }
        
        .report-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .report-tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-left: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .report-tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .report-content {
            display: none;
        }
        
        .report-content.active {
            display: block;
        }
        
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #e1e1e1;
            transition: transform 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .summary-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .summary-card .sub-value {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .client-sales-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .client-sale-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* آلة حاسبة الأسعار */
        .calculator-section {
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #90caf9;
        }
        
        .calculator-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .calculator-result {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 2px solid #2196f3;
            margin-top: 15px;
        }
        
        /* كشوف العمال */
        .employee-report {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .employee-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        /* البضائع والمسحوبات */
        .inventory-section {
            background: linear-gradient(to right, #f0f8ff, #e6f7ff);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #cce7ff;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .inventory-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
            position: relative;
            transition: transform 0.3s;
        }
        
        .inventory-item:hover {
            transform: translateY(-5px);
        }
        
        .inventory-item h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .inventory-item .price {
            font-weight: bold;
            color: #27ae60;
            margin: 5px 0;
        }
        
        .inventory-item .quantity {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .inventory-item .thickness {
            color: #3498db;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .inventory-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .inventory-actions .btn {
            padding: 6px 12px;
            font-size: 12px;
            min-width: auto;
        }
        
        .stock-alert {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .withdrawals-section {
            background: linear-gradient(to right, #fff8e1, #ffecb3);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #ffd54f;
        }
        
        .old-inventory-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #cce7ff;
        }
        
        .edit-inventory-form {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c8e6c9;
        }
        
        /* سجل المشتريات */
        .purchase-history-section {
            background: linear-gradient(to right, #f0f8ff, #e6f7ff);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #cce7ff;
        }
        
        .steel-thickness-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
        }
        
        .total-purchases-section {
            margin-top: 30px;
        }
        
        /* لوحة التحكم */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
        }
        
        .dashboard-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .dashboard-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 14px;
        }
        
        /* التقرير السنوي */
        .annual-report {
            background: linear-gradient(to right, #e8f5e9, #c8e6c9);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #a5d6a7;
        }
        
        .monthly-chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .month-bar {
            background: #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            position: relative;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        .month-bar .bar {
            background: #2c3e50;
            border-radius: 3px;
            transition: height 0.5s;
        }
        
        .month-bar .month-name {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            font-weight: bold;
        }
        
        .month-bar .month-value {
            position: absolute;
            top: 5px;
            left: 0;
            right: 0;
            font-size: 12px;
        }

        /* تفاصيل المبيعات في التقارير */
        .sales-details {
            margin-top: 20px;
        }
        
        .sales-details-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .sales-details-table th,
        .sales-details-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .sales-details-table th {
            background: #3498db;
            color: white;
        }
        
        .sales-details-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 15px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .pagination button.active {
            background: #3498db;
            color: white;
        }
        
        .pagination button:hover:not(.active) {
            background: #e3f2fd;
        }

        /* خلفية الترويسة للطباعة */
        @media print {
            @page {
                margin: 0;
                size: A4;
            }
            
            body {
                background-color: white;
                padding: 0;
                margin: 0;
                font-size: 14px;
                width: 100%;
            }
            
            .container {
                box-shadow: none;
                padding: 10px;
                margin: 0;
                max-width: 100%;
                width: 100%;
                position: relative;
            }
            
            .container::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><rect width="100%" height="100%" fill="white"/><text x="50%" y="45%" font-family="Arial" font-size="48" font-weight="bold" text-anchor="middle" fill="rgba(0,0,0,0.05)">مصنع أحمد العاروري</text><text x="50%" y="55%" font-family="Arial" font-size="36" font-weight="bold" text-anchor="middle" fill="rgba(0,0,0,0.05)">لصناعة أكسسوارات الديكور</text><text x="50%" y="65%" font-family="Arial" font-size="24" text-anchor="middle" fill="rgba(0,0,0,0.05)">FACTORY FOR DECORATION ACCESSORIES</text></svg>');
                background-repeat: no-repeat;
                background-position: center;
                z-index: -1;
                opacity: 0.1;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-header {
                margin-bottom: 20px;
                padding: 15px;
                border-bottom: 3px double #000;
                background: white;
            }
            
            .print-header h1 {
                font-size: 28px;
            }
            
            .print-header h2 {
                font-size: 20px;
            }
            
            .client-info, .total-section {
                border: 2px solid #000 !important;
                margin: 10px 0;
            }
            
            th {
                background: #ddd !important;
                color: #000 !important;
                font-weight: bold;
            }
            
            table {
                border: 1px solid #000;
                width: 100%;
            }
            
            td, th {
                border: 1px solid #000;
                padding: 8px;
            }
            
            .total-section div {
                font-size: 16px;
                font-weight: bold;
            }
            
            .grand-total {
                font-size: 20px;
                border-top: 2px solid #000;
            }
            
            /* تجنب تقسيم الجداول بين الصفحات */
            table { page-break-inside: auto; }
            tr    { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; }
            tfoot { display: table-footer-group; }
        }
        
        @media (max-width: 768px) {
            .invoice-header {
                flex-direction: column;
            }
            
            .invoice-info, .company-info {
                width: 100%;
                margin-bottom: 15px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 10px 5px;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .actions .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .payment-methods {
                flex-direction: column;
            }
            
            .invoice-header-small {
                flex-direction: column;
            }
            
            .payment-row {
                flex-direction: column;
            }
            
            .report-summary {
                grid-template-columns: 1fr;
            }
            
            .calculator-form {
                grid-template-columns: 1fr;
            }
            
            .employee-info {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .monthly-chart {
                grid-template-columns: 1fr;
            }
        }
        
        .search-client {
            margin-bottom: 20px;
        }
        
        .client-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .client-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .client-item:hover {
            background-color: #f0f8ff;
        }
        
        .client-item:last-child {
            border-bottom: none;
        }
        
        .client-financial-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #c8e6c9;
        }
        
        /* أنماط جديدة للتقارير */
        .report-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .annual-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .annual-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #3498db;
        }
        
        .annual-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .annual-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .annual-card .sub-value {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <!-- نافذة تأكيد الحذف -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h3>تأكيد حذف جميع العملاء</h3>
            <p>هذا الإجراء سيحذف جميع بيانات العملاء ولا يمكن التراجع عنه.</p>
            <p>يرجى إدخال كلمة المرور للمتابعة:</p>
            <input type="password" class="modal-input" id="passwordInput" placeholder="أدخل كلمة المرور">
            <div class="modal-actions">
                <button class="btn btn-danger" id="confirmDelete">تأكيد الحذف</button>
                <button class="btn btn-secondary" id="cancelDelete">إلغاء</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- لوحة التحكم -->
        <div class="dashboard-header no-print">
            <div class="dashboard-title">
                <i class="fas fa-industry"></i> نظام إدارة المصنع المتكامل
            </div>
            <div class="dashboard-stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-clients">0</div>
                    <div class="stat-label">العملاء</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-invoices">0</div>
                    <div class="stat-label">الفواتير</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-products">0</div>
                    <div class="stat-label">المنتجات</div>
                </div>
            </div>
        </div>
        
        <!-- ترويسة الطباعة -->
        <div class="print-header">
            <h1>مصنع أحمد العاروري</h1>
            <h2>لصناعة أكسسوارات الديكور</h2>
            <div class="english-title">FACTORY FOR DECORATION ACCESSORIES</div>
            <div id="print-time" style="margin-top: 10px; font-size: 16px; color: #666;"></div>
        </div>
        
        <!-- لوحة الإحصائيات -->
        <div class="dashboard no-print">
            <div class="dashboard-card">
                <i class="fas fa-file-invoice-dollar"></i>
                <div class="value" id="dashboard-invoices">0</div>
                <div class="label">إجمالي الفواتير</div>
            </div>
            <div class="dashboard-card">
                <i class="fas fa-users"></i>
                <div class="value" id="dashboard-clients">0</div>
                <div class="label">إجمالي العملاء</div>
            </div>
            <div class="dashboard-card">
                <i class="fas fa-boxes"></i>
                <div class="value" id="dashboard-inventory">0</div>
                <div class="label">المنتجات في المخزون</div>
            </div>
            <div class="dashboard-card">
                <i class="fas fa-shopping-cart"></i>
                <div class="value" id="dashboard-purchases">0</div>
                <div class="label">عمليات الشراء</div>
            </div>
        </div>
        
        <div class="tabs no-print">
            <div class="tab active" data-tab="invoice">
                <i class="fas fa-file-invoice"></i> إنشاء فاتورة
            </div>
            <div class="tab" data-tab="clients">
                <i class="fas fa-users"></i> إدارة العملاء
            </div>
            <div class="tab" data-tab="history">
                <i class="fas fa-history"></i> سجل الفواتير
            </div>
            <div class="tab" data-tab="purchases">
                <i class="fas fa-shopping-cart"></i> سجل المشتريات
            </div>
            <div class="tab" data-tab="inventory">
                <i class="fas fa-boxes"></i> البضائع والمسحوبات
            </div>
            <div class="tab" data-tab="employees">
                <i class="fas fa-user-tie"></i> كشوف العمال
            </div>
            <div class="tab" data-tab="calculator">
                <i class="fas fa-calculator"></i> آلة حاسبة الأسعار
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-chart-bar"></i> التقارير
            </div>
        </div>
        
        <!-- تبويب إنشاء الفاتورة -->
        <div class="tab-content active" id="invoice-tab">
            <h1><i class="fas fa-file-invoice"></i> إنشاء فاتورة بيع</h1>
            
            <div class="invoice-header">
                <div class="invoice-info">
                    <div><strong>رقم الفاتورة:</strong> <span id="invoice-number">INV-2024-001</span></div>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <div><strong>التاريخ الميلادي:</strong> <span id="invoice-date"></span></div>
                        <input type="date" id="invoice-date-input" style="width: auto; padding: 5px;" value="">
                        <button class="btn" id="update-date-btn" style="width: auto; padding: 5px 10px;"><i class="fas fa-sync-alt"></i> تحديث التاريخ</button>
                    </div>
                    <div><strong>التاريخ الهجري:</strong> <span id="hijri-date"></span></div>
                </div>
                <div class="company-info">
                    <div><strong>المصنع:</strong> مصنع أحمد العاروري</div>
                    <div><strong>العنوان:</strong> الأردن</div>
                    <div><strong>الهاتف:</strong> 0795704514 - 0797083878</div>
                </div>
            </div>
            
            <div class="client-info">
                <h3><i class="fas fa-user"></i> معلومات العميل</h3>
                <div class="search-client">
                    <div class="autocomplete">
                        <input type="text" id="client-search" placeholder="ابحث عن عميل موجود أو أدخل اسم جديد">
                        <div id="client-autocomplete-list" class="autocomplete-items"></div>
                    </div>
                    <button class="btn" id="search-client-btn" style="margin-top: 10px; width: auto;">
                        <i class="fas fa-search"></i> بحث
                    </button>
                </div>
                <div class="client-details">
                    <div>
                        <strong>اسم العميل:</strong> 
                        <input type="text" id="client-name" placeholder="أدخل اسم العميل">
                    </div>
                    <div>
                        <strong>عنوان العميل:</strong> 
                        <input type="text" id="client-address" placeholder="أدخل عنوان العميل">
                    </div>
                    <div>
                        <strong>هاتف العميل:</strong> 
                        <input type="text" id="client-phone" placeholder="أدخل هاتف العميل">
                    </div>
                </div>
                <div id="client-balance-info" class="client-balance" style="display: none;">
                    <strong>رصيد العميل السابق:</strong> 
                    <span id="previous-balance">0.00</span> دينار
                </div>
            </div>
            
            <table id="products-table">
                <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="25%">اسم المنتج</th>
                        <th width="10%">الكمية</th>
                        <th width="15%">سعر الوحدة (شامل الضريبة)</th>
                        <th width="10%">الخصم (%)</th>
                        <th width="15%">المجموع</th>
                        <th width="10%" class="no-print">إجراءات</th>
                    </tr>
                </thead>
                <tbody id="products-body">
                    <!-- سيتم إضافة الصفوف هنا ديناميكيًا -->
                </tbody>
            </table>
            
            <div class="actions no-print">
                <button class="btn" id="add-product">
                    <i class="fas fa-plus"></i> إضافة منتج
                </button>
                <button class="btn btn-success" id="calculate-totals">
                    <i class="fas fa-calculator"></i> حساب المجموع
                </button>
            </div>
            
            <div class="total-section">
                <div>المجموع الفرعي: <span id="subtotal">0.00</span> دينار</div>
                <div>إجمالي الخصم: <span id="total-discount">0.00</span> دينار</div>
                <div>الضريبة (16%): <span id="total-tax">0.00</span> دينار</div>
                <div class="grand-total">المجموع الكلي: <span id="grand-total">0.00</span> دينار</div>
            </div>
            
            <div class="payment-section">
                <h3><i class="fas fa-credit-card"></i> طريقة الدفع</h3>
                <div class="multiple-payments">
                    <label>
                        <input type="checkbox" id="enable-multiple-payments">
                        تمكين الدفع بأكثر من طريقة
                    </label>
                    
                    <div id="multiple-payments-section" style="display: none; margin-top: 15px;">
                        <div class="payment-row">
                            <select class="payment-method-select">
                                <option value="cash">كاش</option>
                                <option value="check">شيكات</option>
                                <option value="exchange">تبديل بضائع</option>
                                <option value="bank">تحويل بنكي</option>
                            </select>
                            <input type="number" class="payment-amount" placeholder="المبلغ" min="0" step="0.01">
                            <button class="btn btn-danger remove-payment">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                        <button class="btn" id="add-payment-method">
                            <i class="fas fa-plus"></i> إضافة طريقة دفع أخرى
                        </button>
                        
                        <div class="payment-summary">
                            <strong>إجمالي المدفوع:</strong> <span id="total-paid">0.00</span> دينار
                        </div>
                    </div>
                </div>
                
                <div id="single-payment-section">
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="radio" id="cash" name="payment-method" value="cash" checked>
                            <label for="cash"><i class="fas fa-money-bill-wave"></i> كاش</label>
                        </div>
                        <div class="payment-method">
                            <input type="radio" id="check" name="payment-method" value="check">
                            <label for="check"><i class="fas fa-money-check"></i> شيكات</label>
                        </div>
                        <div class="payment-method">
                            <input type="radio" id="exchange" name="payment-method" value="exchange">
                            <label for="exchange"><i class="fas fa-exchange-alt"></i> تبديل بضائع</label>
                        </div>
                    </div>
                    
                    <div id="payment-details">
                        <div>
                            <strong>المبلغ المدفوع:</strong>
                            <input type="number" id="paid-amount" value="0.00" min="0" step="0.01" style="width: 200px; display: inline-block; margin-right: 10px;">
                            <button class="btn no-print" id="set-full-payment" style="width: auto;">
                                <i class="fas fa-check-circle"></i> دفع المبلغ كاملاً
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="remaining-balance" id="remaining-balance">
                    المبلغ المتبقي: <span id="balance-amount">0.00</span> دينار
                </div>
            </div>
            
            <div class="actions no-print">
                <button class="btn btn-success" id="print-invoice">
                    <i class="fas fa-print"></i> طباعة الفاتورة
                </button>
                <button class="btn btn-secondary" id="save-invoice">
                    <i class="fas fa-save"></i> حفظ الفاتورة
                </button>
                <button class="btn btn-danger" id="reset-invoice">
                    <i class="fas fa-redo"></i> إعادة تعيين
                </button>
            </div>
        </div>
        
        <!-- تبويب إدارة العملاء -->
        <div class="tab-content" id="clients-tab">
            <h1><i class="fas fa-users"></i> إدارة العملاء</h1>
            
            <div class="client-info">
                <h3><i class="fas fa-user-plus"></i> إضافة عميل جديد</h3>
                <div class="client-details">
                    <div>
                        <strong>اسم العميل:</strong> 
                        <input type="text" id="new-client-name" placeholder="أدخل اسم العميل">
                    </div>
                    <div>
                        <strong>عنوان العميل:</strong> 
                        <input type="text" id="new-client-address" placeholder="أدخل عنوان العميل">
                    </div>
                    <div>
                        <strong>هاتف العميل:</strong> 
                        <input type="text" id="new-client-phone" placeholder="أدخل هاتف العميل">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-success" id="save-client">
                        <i class="fas fa-save"></i> حفظ العميل
                    </button>
                    <button class="btn btn-danger" id="clear-all-clients">
                        <i class="fas fa-trash"></i> مسح جميع العملاء
                    </button>
                </div>
            </div>
            
            <div class="client-history">
                <h3><i class="fas fa-list"></i> قائمة العملاء</h3>
                <div class="search-client">
                    <input type="text" id="filter-clients" placeholder="ابحث عن عميل">
                </div>
                <div class="client-list" id="client-list">
                    <!-- سيتم عرض العملاء هنا -->
                </div>
                
                <div id="client-invoices-section" style="display: none;">
                    <h3>فواتير العميل: <span id="current-client-name"></span></h3>
                    
                    <div class="client-financial-info">
                        <h4>المعلومات المالية</h4>
                        <div>الرصيد الحالي: <span id="current-client-balance">0.00</span> دينار</div>
                        <div>إجمالي المشتريات: <span id="total-client-purchases">0.00</span> دينار</div>
                        <div>إجمالي المدفوعات: <span id="total-client-payments">0.00</span> دينار</div>
                    </div>
                    
                    <div class="payment-form" id="payment-form" style="display: none;">
                        <h4>إضافة دفعة</h4>
                        <div class="client-details">
                            <div>
                                <strong>المبلغ:</strong>
                                <input type="number" id="payment-amount" value="0.00" min="0" step="0.01">
                            </div>
                            <div>
                                <strong>طريقة الدفع:</strong>
                                <select id="payment-method-select">
                                    <option value="cash">كاش</option>
                                    <option value="check">شيكات</option>
                                    <option value="bank">تحويل بنكي</option>
                                </select>
                            </div>
                        </div>
                        <div class="actions">
                            <button class="btn btn-success" id="add-payment">
                                <i class="fas fa-plus"></i> إضافة الدفعة
                            </button>
                            <button class="btn btn-secondary" id="cancel-payment">
                                <i class="fas fa-times"></i> إلغاء
                            </button>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-success" id="show-payment-form">
                            <i class="fas fa-money-bill-wave"></i> إضافة دفعة جديدة
                        </button>
                    </div>
                    
                    <div class="client-payments" id="client-payments">
                        <h4>سجل الدفعات</h4>
                        <!-- سيتم عرض الدفعات هنا -->
                    </div>
                    
                    <div id="client-invoices">
                        <!-- سيتم عرض فواتير العميل هنا -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- تبويب سجل الفواتير -->
        <div class="tab-content" id="history-tab">
            <h1><i class="fas fa-history"></i> سجل الفواتير</h1>
            
            <div class="search-client">
                <input type="text" id="history-client-search" placeholder="ابحث عن عميل">
                <button class="btn" id="search-history-btn" style="margin-top: 10px; width: auto;">
                    <i class="fas fa-search"></i> بحث
                </button>
                <button class="btn btn-danger" id="clear-all-invoices" style="margin-top: 10px; width: auto;">
                    <i class="fas fa-trash"></i> مسح جميع الفواتير
                </button>
            </div>
            
            <div class="client-history">
                <h3 id="selected-client-name">جميع الفواتير</h3>
                <div id="invoices-history">
                    <!-- سيتم عرض الفواتير هنا -->
                </div>
            </div>
        </div>
        
        <!-- تبويب سجل المشتريات -->
        <div class="tab-content" id="purchases-tab">
            <h1><i class="fas fa-shopping-cart"></i> سجل مشتريات العملاء</h1>
            
            <div class="search-client">
                <input type="text" id="purchase-client-search" placeholder="ابحث عن عميل">
                <button class="btn" id="search-purchase-btn" style="margin-top: 10px; width: auto;">
                    <i class="fas fa-search"></i> بحث
                </button>
                <button class="btn btn-danger" id="clear-all-purchases" style="margin-top: 10px; width: auto;">
                    <i class="fas fa-trash"></i> مسح جميع المشتريات
                </button>
            </div>
            
            <div class="purchase-history-section">
                <h3 id="purchase-client-name">سجل المشتريات</h3>
                <div id="purchase-history">
                    <!-- سيتم عرض سجل المشتريات هنا -->
                </div>
            </div>
            
            <div class="total-purchases-section">
                <h3>إجمالي المشتريات حسب السماكة</h3>
                <div class="steel-thickness-section">
                    <div id="steel-thickness-purchases">
                        <!-- سيتم عرض المشتريات حسب السماكة هنا -->
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">إجمالي المشتريات حسب القطع</h3>
                <div id="total-purchases">
                    <!-- سيتم عرض إجمالي المشتريات هنا -->
                </div>
            </div>
        </div>
        
        <!-- تبويب البضائع والمسحوبات -->
        <div class="tab-content" id="inventory-tab">
            <h1><i class="fas fa-boxes"></i> إدارة البضائع والمسحوبات</h1>
            
            <div class="inventory-section">
                <h3><i class="fas fa-plus"></i> إضافة حديد جديد</h3>
                <div class="client-details">
                    <div>
                        <strong>نوع الحديد:</strong>
                        <select id="steel-type">
                            <option value="زوايا">زوايا</option>
                            <option value="تركات">تركات</option>
                            <option value="امقاا">امقاا</option>
                            <option value="امقا">امقا</option>
                            <option value="سي شانل">سي شانل</option>
                            <option value="ستاد">ستاد</option>
                            <option value="زاويه الظل">زاويه الظل</option>
                        </select>
                    </div>
                    <div>
                        <strong>سماكة الحديد (مم):</strong>
                        <input type="number" id="steel-thickness" placeholder="أدخل السماكة" step="0.1" min="0.1">
                    </div>
                    <div>
                        <strong>الكمية (عدد القطع):</strong>
                        <input type="number" id="steel-quantity" value="1" min="1">
                    </div>
                    <div>
                        <strong>السعر (اختياري):</strong>
                        <input type="number" id="steel-price" value="0.00" min="0" step="0.01">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-success" id="add-steel">
                        <i class="fas fa-plus"></i> إضافة الحديد
                    </button>
                </div>
                
                <h3 style="margin-top: 30px;"><i class="fas fa-box-open"></i> البضائع الموجودة</h3>
                <div class="edit-inventory-form" id="edit-inventory-form" style="display: none;">
                    <h4>تعديل البضاعة</h4>
                    <div class="client-details">
                        <div>
                            <strong>اسم البضاعة:</strong>
                            <input type="text" id="edit-product-name">
                        </div>
                        <div>
                            <strong>السماكة (مم):</strong>
                            <input type="number" id="edit-product-thickness" step="0.1" min="0.1">
                        </div>
                        <div>
                            <strong>الكمية:</strong>
                            <input type="number" id="edit-product-quantity" min="0">
                        </div>
                        <div>
                            <strong>السعر:</strong>
                            <input type="number" id="edit-product-price" min="0" step="0.01">
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-success" id="save-edit-inventory">
                            <i class="fas fa-save"></i> حفظ التعديلات
                        </button>
                        <button class="btn btn-secondary" id="cancel-edit-inventory">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                    </div>
                </div>
                <div class="inventory-grid" id="inventory-grid">
                    <!-- سيتم عرض البضائع هنا -->
                </div>
            </div>
            
            <div class="old-inventory-section">
                <h3><i class="fas fa-archive"></i> البضائع القديمة الموجودة في المصنع</h3>
                <div class="client-details">
                    <div>
                        <strong>اسم البضاعة:</strong>
                        <input type="text" id="old-product-name" placeholder="أدخل اسم البضاعة">
                    </div>
                    <div>
                        <strong>الكمية:</strong>
                        <input type="number" id="old-product-quantity" value="1" min="1">
                    </div>
                    <div>
                        <strong>السعر (اختياري):</strong>
                        <input type="number" id="old-product-price" value="0.00" min="0" step="0.01">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary" id="add-old-product">
                        <i class="fas fa-plus"></i> إضافة بضاعة قديمة
                    </button>
                </div>
            </div>
            
            <div class="withdrawals-section">
                <h3><i class="fas fa-hand-holding"></i> تسجيل مسحوبات</h3>
                <div class="client-details">
                    <div>
                        <strong>اسم المستلم:</strong>
                        <input type="text" id="withdrawal-recipient" placeholder="أدخل اسم المستلم">
                    </div>
                    <div>
                        <strong>البضاعة:</strong>
                        <select id="withdrawal-product">
                            <option value="">اختر البضاعة</option>
                        </select>
                    </div>
                    <div>
                        <strong>الكمية:</strong>
                        <input type="number" id="withdrawal-quantity" value="1" min="1">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-danger" id="save-withdrawal">
                        <i class="fas fa-save"></i> تسجيل المسحوبات
                    </button>
                </div>
                
                <div id="withdrawals-history">
                    <h4>سجل المسحوبات</h4>
                    <table id="withdrawals-table">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>المستلم</th>
                                <th>البضاعة</th>
                                <th>الكمية</th>
                                <th class="no-print">إجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawals-body">
                            <!-- سيتم عرض المسحوبات هنا -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- تبويب كشوف العمال -->
        <div class="tab-content" id="employees-tab">
            <h1><i class="fas fa-user-tie"></i> كشوف رواتب العمال</h1>
            
            <div class="employee-report">
                <h3>إنشاء كشف راتب</h3>
                <div class="employee-info">
                    <div>
                        <strong>اسم العامل:</strong>
                        <input type="text" id="employee-name" placeholder="أدخل اسم العامل">
                    </div>
                    <div>
                        <strong>رقم الهوية:</strong>
                        <input type="text" id="employee-id" placeholder="أدخل رقم الهوية">
                    </div>
                    <div>
                        <strong>المسمى الوظيفي:</strong>
                        <input type="text" id="employee-position" placeholder="المسمى الوظيفي">
                    </div>
                    <div>
                        <strong>الشهر:</strong>
                        <select id="employee-month">
                            <option value="1">يناير</option>
                            <option value="2">فبراير</option>
                            <option value="3">مارس</option>
                            <option value="4">أبريل</option>
                            <option value="5">مايو</option>
                            <option value="6">يونيو</option>
                            <option value="7">يوليو</option>
                            <option value="8">أغسطس</option>
                            <option value="9">سبتمبر</option>
                            <option value="10">أكتوبر</option>
                            <option value="11">نوفمبر</option>
                            <option value="12">ديسمبر</option>
                        </select>
                    </div>
                    <div>
                        <strong>السنة:</strong>
                        <input type="number" id="employee-year" value="2024" min="2020" max="2030">
                    </div>
                    <div>
                        <strong>الراتب الأساسي:</strong>
                        <input type="number" id="employee-salary" value="0.00" min="0" step="0.01">
                    </div>
                    <div>
                        <strong>الإضافي:</strong>
                        <input type="number" id="employee-overtime" value="0.00" min="0" step="0.01">
                    </div>
                    <div>
                        <strong>الخصومات:</strong>
                        <input type="number" id="employee-deductions" value="0.00" min="0" step="0.01">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-success" id="calculate-salary">
                        <i class="fas fa-calculator"></i> حساب الراتب
                    </button>
                    <button class="btn" id="print-salary">
                        <i class="fas fa-print"></i> طباعة الكشف
                    </button>
                    <button class="btn btn-secondary" id="save-salary">
                        <i class="fas fa-save"></i> حفظ الكشف
                    </button>
                </div>
                
                <div class="total-section" id="salary-result" style="display: none;">
                    <div>الراتب الأساسي: <span id="basic-salary">0.00</span> دينار</div>
                    <div>الإضافي: <span id="overtime-amount">0.00</span> دينار</div>
                    <div>الخصومات: <span id="deductions-amount">0.00</span> دينار</div>
                    <div class="grand-total">صافي الراتب: <span id="net-salary">0.00</span> دينار</div>
                </div>
            </div>
            
            <div class="client-history">
                <h3>كشوف العمال المحفوظة</h3>
                <div id="saved-salaries">
                    <!-- سيتم عرض الكشوف المحفوظة هنا -->
                </div>
            </div>
        </div>

        <!-- تبويب آلة حاسبة الأسعار -->
        <div class="tab-content" id="calculator-tab">
            <h1><i class="fas fa-calculator"></i> آلة حاسبة حساب الأسعار</h1>
            
            <div class="calculator-section">
                <h3>حساب الوزن والسماكة وعرض الشريحة</h3>
                <div class="calculator-form">
                    <div>
                        <strong>اختر نوع الحساب:</strong>
                        <select id="calculation-type">
                            <option value="1">حساب الوزن</option>
                            <option value="2">حساب السماكة</option>
                            <option value="3">حساب عرض الشريحة</option>
                        </select>
                    </div>
                    
                    <div id="input-fields">
                        <!-- سيتم عرض الحقول الديناميكية هنا -->
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" id="calculate-steel">
                        <i class="fas fa-calculator"></i> احسب
                    </button>
                    <button class="btn btn-secondary" id="reset-calculator">
                        <i class="fas fa-redo"></i> إعادة تعيين
                    </button>
                </div>
                
                <div class="calculator-result" id="calculator-result" style="display: none;">
                    <h4>نتيجة الحساب:</h4>
                    <div id="result-details">
                        <!-- سيتم عرض النتائج هنا -->
                    </div>
                </div>
            </div>
            
            <div class="client-info" style="margin-top: 30px;">
                <h3>معلومات عن الحسابات</h3>
                <p><strong>معادلة حساب الوزن:</strong> الوزن = عرض الشريحة × السماكة × 300 × 7.85</p>
                <p><strong>معادلة حساب السماكة:</strong> السماكة = الوزن ÷ (عرض الشريحة × 300 × 7.85)</p>
                <p><strong>معادلة حساب عرض الشريحة:</strong> عرض الشريحة = الوزن ÷ (السماكة × 300 × 7.85)</p>
                <p><strong>ملاحظة:</strong> 7.85 هو كثافة الحديد (جرام/سم³)، 300 هو الطول الثابت (سم)</p>
            </div>
        </div>
        
        <!-- تبويب التقارير -->
        <div class="tab-content" id="reports-tab">
            <h1><i class="fas fa-chart-bar"></i> التقارير والإحصائيات</h1>
            
            <div class="report-actions no-print">
                <button class="btn btn-info" id="print-daily-report">
                    <i class="fas fa-print"></i> طباعة التقرير اليومي
                </button>
                <button class="btn btn-info" id="print-weekly-report">
                    <i class="fas fa-print"></i> طباعة التقرير الأسبوعي
                </button>
                <button class="btn btn-info" id="print-monthly-report">
                    <i class="fas fa-print"></i> طباعة التقرير الشهري
                </button>
                <button class="btn btn-info" id="print-annual-report">
                    <i class="fas fa-print"></i> طباعة التقرير السنوي
                </button>
            </div>
            
            <div class="reports-section">
                <div class="report-tabs">
                    <div class="report-tab active" data-report="daily">
                        <i class="fas fa-calendar-day"></i> التقرير اليومي
                    </div>
                    <div class="report-tab" data-report="weekly">
                        <i class="fas fa-calendar-week"></i> التقرير الأسبوعي
                    </div>
                    <div class="report-tab" data-report="monthly">
                        <i class="fas fa-calendar-alt"></i> التقرير الشهري
                    </div>
                    <div class="report-tab" data-report="annual">
                        <i class="fas fa-calendar"></i> التقرير السنوي
                    </div>
                </div>
                
                <!-- التقرير اليومي -->
                <div class="report-content active" id="daily-report">
                    <h3>تقرير المبيعات اليومي</h3>
                    <div class="report-summary">
                        <div class="summary-card">
                            <h4>إجمالي المبيعات</h4>
                            <div class="value" id="daily-total-sales">0.00 دينار</div>
                            <div class="sub-value" id="daily-invoices-count">0 فاتورة</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد المنتجات المباعة</h4>
                            <div class="value" id="daily-products-sold">0 منتج</div>
                            <div class="sub-value" id="daily-units-sold">0 وحدة</div>
                        </div>
                        <div class="summary-card">
                            <h4>متوسط قيمة الفاتورة</h4>
                            <div class="value" id="daily-avg-invoice">0.00 دينار</div>
                            <div class="sub-value">لكل فاتورة</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد العملاء</h4>
                            <div class="value" id="daily-customers-count">0 عميل</div>
                            <div class="sub-value">عملاء مختلفين</div>
                        </div>
                    </div>
                    
                    <div class="sales-details">
                        <h4>تفاصيل المبيعات</h4>
                        <div id="daily-sales-details">
                            <!-- سيتم عرض تفاصيل المبيعات اليومية هنا -->
                        </div>
                    </div>
                </div>
                
                <!-- التقرير الأسبوعي -->
                <div class="report-content" id="weekly-report">
                    <h3>تقرير المبيعات الأسبوعي</h3>
                    <div class="report-summary">
                        <div class="summary-card">
                            <h4>إجمالي المبيعات</h4>
                            <div class="value" id="weekly-total-sales">0.00 دينار</div>
                            <div class="sub-value" id="weekly-invoices-count">0 فاتورة</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد المنتجات المباعة</h4>
                            <div class="value" id="weekly-products-sold">0 منتج</div>
                            <div class="sub-value" id="weekly-units-sold">0 وحدة</div>
                        </div>
                        <div class="summary-card">
                            <h4>متوسط المبيعات اليومية</h4>
                            <div class="value" id="weekly-avg-daily">0.00 دينار</div>
                            <div class="sub-value">لكل يوم</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد العملاء</h4>
                            <div class="value" id="weekly-customers-count">0 عميل</div>
                            <div class="sub-value">عملاء مختلفين</div>
                        </div>
                    </div>
                    
                    <div class="sales-details">
                        <h4>تفاصيل المبيعات</h4>
                        <div id="weekly-sales-details">
                            <!-- سيتم عرض تفاصيل المبيعات الأسبوعية هنا -->
                        </div>
                    </div>
                </div>
                
                <!-- التقرير الشهري -->
                <div class="report-content" id="monthly-report">
                    <h3>تقرير المبيعات الشهري</h3>
                    <div class="report-summary">
                        <div class="summary-card">
                            <h4>إجمالي المبيعات</h4>
                            <div class="value" id="monthly-total-sales">0.00 دينار</div>
                            <div class="sub-value" id="monthly-invoices-count">0 فاتورة</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد المنتجات المباعة</h4>
                            <div class="value" id="monthly-products-sold">0 منتج</div>
                            <div class="sub-value" id="monthly-units-sold">0 وحدة</div>
                        </div>
                        <div class="summary-card">
                            <h4>متوسط المبيعات اليومية</h4>
                            <div class="value" id="monthly-avg-daily">0.00 دينار</div>
                            <div class="sub-value">لكل يوم</div>
                        </div>
                        <div class="summary-card">
                            <h4>عدد العملاء</h4>
                            <div class="value" id="monthly-customers-count">0 عميل</div>
                            <div class="sub-value">عملاء مختلفين</div>
                        </div>
                    </div>
                    
                    <div class="sales-details">
                        <h4>تفاصيل المبيعات</h4>
                        <div id="monthly-sales-details">
                            <!-- سيتم عرض تفاصيل المبيعات الشهرية هنا -->
                        </div>
                    </div>
                </div>
                
                <!-- التقرير السنوي -->
                <div class="report-content" id="annual-report">
                    <h3>تقرير المبيعات السنوي</h3>
                    <div class="annual-summary">
                        <div class="annual-card">
                            <h4>إجمالي المبيعات السنوية</h4>
                            <div class="value" id="annual-total-sales">0.00 دينار</div>
                            <div class="sub-value" id="annual-invoices-count">0 فاتورة</div>
                        </div>
                        <div class="annual-card">
                            <h4>أفضل شهر في المبيعات</h4>
                            <div class="value" id="best-month-sales">0.00 دينار</div>
                            <div class="sub-value" id="best-month-name">غير محدد</div>
                        </div>
                        <div class="annual-card">
                            <h4>متوسط المبيعات الشهرية</h4>
                            <div class="value" id="monthly-avg-sales">0.00 دينار</div>
                            <div class="sub-value">لكل شهر</div>
                        </div>
                        <div class="annual-card">
                            <h4>عدد العملاء السنوي</h4>
                            <div class="value" id="annual-customers-count">0 عميل</div>
                            <div class="sub-value">عملاء مختلفين</div>
                        </div>
                    </div>
                    
                    <h4>مبيعات الشهور خلال السنة</h4>
                    <div class="monthly-chart" id="monthly-chart">
                        <!-- سيتم عرض الرسم البياني للشهور هنا -->
                    </div>
                    
                    <div class="sales-details">
                        <h4>تفاصيل المبيعات السنوية</h4>
                        <div id="annual-sales-details">
                            <!-- سيتم عرض تفاصيل المبيعات السنوية هنا -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // كلمة المرور لحذف العملاء والفواتير
        const DELETE_PASSWORD = "12345678";
        
        // متغيرات النظام
        let productCount = 0;
        let clients = JSON.parse(localStorage.getItem('clients')) || [];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let withdrawals = JSON.parse(localStorage.getItem('withdrawals')) || [];
        let purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory')) || [];
        let oldInventory = JSON.parse(localStorage.getItem('oldInventory')) || [];
        let employeeSalaries = JSON.parse(localStorage.getItem('employeeSalaries')) || [];
        let currentViewingClient = null;
        let editingInventoryItem = null;
        
        // متغيرات التقسيم للتقارير
        let currentSalesPage = 1;
        const salesPerPage = 10;
        
        // قائمة المنتجات الأساسية
        const baseProducts = [
            "زوايا", "تركات", "امقاا", "امقا", "سي شانل", "ستاد", "زاويه الظل",
            "ألواح جبسمبورد أبيض", "ألواح جبسمبورد أخضر", "بضائع أخوة متنوعة"
        ];
        
        // تعيين التواريخ الافتراضية
        function setDefaultDates() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('invoice-date-input').value = `${year}-${month}-${day}`;
            updateDatesFromInput();
        }
        
        // دالة لتحديث التواريخ من حقل الإدخال
        function updateDatesFromInput() {
            const dateInput = document.getElementById('invoice-date-input').value;
            if (dateInput) {
                const selectedDate = new Date(dateInput + 'T12:00:00');
                document.getElementById('invoice-date').textContent = selectedDate.toLocaleDateString('en-US');
                document.getElementById('hijri-date').textContent = getHijriDateFromDate(selectedDate);
            } else {
                const today = new Date();
                document.getElementById('invoice-date').textContent = today.toLocaleDateString('en-US');
                document.getElementById('hijri-date').textContent = getHijriDateFromDate(today);
            }
        }
        
        // دالة لحساب التاريخ الهجري من تاريخ ميلادي معين
        function getHijriDateFromDate(date) {
            try {
                return new Intl.DateTimeFormat('ar-TN-u-ca-islamic', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                }).format(date);
            } catch (e) {
                return 'غير متاح';
            }
        }
        
        // دالة بسيطة لحساب التاريخ الهجري (للتوافق مع الكود القديم)
        function getHijriDate() {
            return getHijriDateFromDate(new Date());
        }
        
        // تحديث لوحة التحكم
        function updateDashboard() {
            document.getElementById('dashboard-invoices').textContent = invoices.length;
            document.getElementById('dashboard-clients').textContent = clients.length;
            document.getElementById('dashboard-inventory').textContent = inventory.length + oldInventory.length;
            document.getElementById('dashboard-purchases').textContent = purchaseHistory.length;
            
            document.getElementById('total-clients').textContent = clients.length;
            document.getElementById('total-invoices').textContent = invoices.length;
            document.getElementById('total-products').textContent = inventory.length + oldInventory.length;
        }
        
        // إعداد التبويبات
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-tab') + '-tab').classList.add('active');
                
                if (this.getAttribute('data-tab') === 'clients') {
                    loadClientsList();
                } else if (this.getAttribute('data-tab') === 'history') {
                    loadInvoicesHistory();
                } else if (this.getAttribute('data-tab') === 'purchases') {
                    loadPurchaseHistory();
                    loadTotalPurchases();
                    loadSteelThicknessPurchases();
                } else if (this.getAttribute('data-tab') === 'inventory') {
                    loadInventory();
                    loadWithdrawals();
                    populateWithdrawalProducts();
                } else if (this.getAttribute('data-tab') === 'employees') {
                    loadEmployeeSalaries();
                } else if (this.getAttribute('data-tab') === 'calculator') {
                    setupCalculator();
                } else if (this.getAttribute('data-tab') === 'reports') {
                    loadReports();
                }
                
                updateDashboard();
            });
        });
        
        // إعداد تبويبات التقارير
        document.querySelectorAll('.report-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.report-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.report-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-report') + '-report').classList.add('active');
                
                currentSalesPage = 1;
                
                if (this.getAttribute('data-report') === 'daily') {
                    loadDailyReport();
                } else if (this.getAttribute('data-report') === 'weekly') {
                    loadWeeklyReport();
                } else if (this.getAttribute('data-report') === 'monthly') {
                    loadMonthlyReport();
                } else if (this.getAttribute('data-report') === 'annual') {
                    loadAnnualReport();
                }
            });
        });
        
        // ربط زر تحديث التاريخ
        document.getElementById('update-date-btn').addEventListener('click', updateDatesFromInput);
        
        // إضافة منتج جديد
        document.getElementById('add-product').addEventListener('click', function() {
            addProductRow();
        });
        
        // حساب المجموع الكلي
        document.getElementById('calculate-totals').addEventListener('click', function() {
            calculateTotals();
            updatePaymentBalance();
        });
        
        // طباعة الفاتورة
        document.getElementById('print-invoice').addEventListener('click', function() {
            updateDatesFromInput();
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-EG');
            document.getElementById('print-time').textContent = `وقت الطباعة: ${timeString}`;
            window.print();
        });
        
        // حفظ الفاتورة
        document.getElementById('save-invoice').addEventListener('click', function() {
            saveInvoice();
        });
        
        // إعادة تعيين الفاتورة
        document.getElementById('reset-invoice').addEventListener('click', function() {
            if(confirm('هل أنت متأكد من إعادة تعيين الفاتورة؟ سيتم حذف جميع البيانات.')) {
                resetInvoiceForm();
            }
        });
        
        // حفظ العميل
        document.getElementById('save-client').addEventListener('click', function() {
            saveClient();
        });
        
        // مسح جميع العملاء مع التحقق بكلمة المرور
        document.getElementById('clear-all-clients').addEventListener('click', function() {
            document.getElementById('deleteModal').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
        });
        
        // تأكيد الحذف
        document.getElementById('confirmDelete').addEventListener('click', function() {
            const password = document.getElementById('passwordInput').value;
            if (password === DELETE_PASSWORD) {
                clients = [];
                localStorage.setItem('clients', JSON.stringify(clients));
                showNotification('تم مسح جميع العملاء بنجاح');
                loadClientsList();
                document.getElementById('deleteModal').style.display = 'none';
                document.getElementById('passwordInput').value = '';
                updateDashboard();
            } else {
                showNotification('كلمة المرور غير صحيحة', 'error');
            }
        });
        
        // إلغاء الحذف
        document.getElementById('cancelDelete').addEventListener('click', function() {
            document.getElementById('deleteModal').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        });
        
        // مسح جميع الفواتير
        document.getElementById('clear-all-invoices').addEventListener('click', function() {
            if(confirm('هل أنت متأكد من مسح جميع الفواتير؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                const password = prompt('يرجى إدخال كلمة المرور للمتابعة:');
                if (password === DELETE_PASSWORD) {
                    invoices = [];
                    localStorage.setItem('invoices', JSON.stringify(invoices));
                    showNotification('تم مسح جميع الفواتير بنجاح');
                    loadInvoicesHistory();
                    updateDashboard();
                } else {
                    showNotification('كلمة المرور غير صحيحة', 'error');
                }
            }
        });
        
        // مسح جميع المشتريات
        document.getElementById('clear-all-purchases').addEventListener('click', function() {
            if(confirm('هل أنت متأكد من مسح جميع سجل المشتريات؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                const password = prompt('يرجى إدخال كلمة المرور للمتابعة:');
                if (password === DELETE_PASSWORD) {
                    purchaseHistory = [];
                    localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
                    showNotification('تم مسح جميع المشتريات بنجاح');
                    loadPurchaseHistory();
                    loadTotalPurchases();
                    loadSteelThicknessPurchases();
                    updateDashboard();
                } else {
                    showNotification('كلمة المرور غير صحيحة', 'error');
                }
            }
        });
        
        // البحث عن عميل
        document.getElementById('search-client-btn').addEventListener('click', function() {
            searchClient();
        });
        
        // البحث التلقائي عن العملاء
        document.getElementById('client-search').addEventListener('input', function() {
            autocompleteClient(this.value);
        });
        
        // تصفية العملاء
        document.getElementById('filter-clients').addEventListener('input', function() {
            filterClients(this.value);
        });
        
        // البحث في سجل الفواتير
        document.getElementById('search-history-btn').addEventListener('click', function() {
            searchInvoicesHistory();
        });
        
        // البحث في سجل المشتريات
        document.getElementById('search-purchase-btn').addEventListener('click', function() {
            searchPurchaseHistory();
        });
        
        // إضافة دفعة للعميل
        document.getElementById('add-payment').addEventListener('click', function() {
            addPayment();
        });
        
        // إلغاء إضافة دفعة
        document.getElementById('cancel-payment').addEventListener('click', function() {
            document.getElementById('payment-form').style.display = 'none';
        });
        
        // عرض نموذج الدفعة
        document.getElementById('show-payment-form').addEventListener('click', function() {
            document.getElementById('payment-form').style.display = 'block';
        });
        
        // الدفع
        document.getElementById('set-full-payment').addEventListener('click', function() {
            const grandTotal = parseFloat(document.getElementById('grand-total').textContent) || 0;
            document.getElementById('paid-amount').value = grandTotal.toFixed(2);
            updatePaymentBalance();
        });
        
        document.getElementById('paid-amount').addEventListener('input', function() {
            updatePaymentBalance();
        });
        
        // إعداد الدفعات المتعددة
        document.getElementById('enable-multiple-payments').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('multiple-payments-section').style.display = 'block';
                document.getElementById('single-payment-section').style.display = 'none';
            } else {
                document.getElementById('multiple-payments-section').style.display = 'none';
                document.getElementById('single-payment-section').style.display = 'block';
            }
            updatePaymentBalance();
        });
        
        // إضافة حديد جديد
        document.getElementById('add-steel').addEventListener('click', function() {
            addSteel();
        });
        
        // إضافة بضاعة قديمة
        document.getElementById('add-old-product').addEventListener('click', function() {
            addOldProduct();
        });
        
        // حفظ تعديل المخزون
        document.getElementById('save-edit-inventory').addEventListener('click', function() {
            saveEditInventory();
        });
        
        // إلغاء تعديل المخزون
        document.getElementById('cancel-edit-inventory').addEventListener('click', function() {
            document.getElementById('edit-inventory-form').style.display = 'none';
            editingInventoryItem = null;
        });
        
        // إدارة البضائع
        document.getElementById('save-withdrawal').addEventListener('click', function() {
            saveWithdrawal();
        });
        
        // كشوف العمال
        document.getElementById('calculate-salary').addEventListener('click', function() {
            calculateSalary();
        });
        
        document.getElementById('print-salary').addEventListener('click', function() {
            printSalary();
        });
        
        document.getElementById('save-salary').addEventListener('click', function() {
            saveSalary();
        });
        
        // آلة حاسبة الأسعار
        document.getElementById('calculation-type').addEventListener('change', function() {
            setupCalculatorInputs();
        });
        
        document.getElementById('calculate-steel').addEventListener('click', function() {
            calculateSteel();
        });
        
        document.getElementById('reset-calculator').addEventListener('click', function() {
            resetCalculator();
        });
        
        // طباعة التقارير
        document.getElementById('print-daily-report').addEventListener('click', function() {
            printReport('daily');
        });
        
        document.getElementById('print-weekly-report').addEventListener('click', function() {
            printReport('weekly');
        });
        
        document.getElementById('print-monthly-report').addEventListener('click', function() {
            printReport('monthly');
        });
        
        document.getElementById('print-annual-report').addEventListener('click', function() {
            printReport('annual');
        });
        
        // عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', function() {
            setDefaultDates();
            addProductRow();
            loadClientsList();
            loadInvoicesHistory();
            setupMultiplePayments();
            loadReports();
            setupCalculator();
            updateDashboard();
        });
        
        // دالة لحذف سجلات المشتريات المرتبطة بفاتورة معينة
        function deletePurchaseHistoryByInvoiceId(invoiceId) {
            purchaseHistory = purchaseHistory.filter(p => p.invoiceId !== invoiceId);
            localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
        }

        // دالة معدلة لإضافة المنتجات إلى سجل المشتريات
        function addToPurchaseHistory(productName, quantity, price, clientName, invoiceId) {
            const purchase = {
                id: Date.now().toString() + Math.random(),
                date: new Date().toISOString(),
                productName,
                quantity,
                price,
                total: quantity * price,
                clientName,
                invoiceId: invoiceId
            };
            purchaseHistory.push(purchase);
            localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
        }

        // دالة حفظ الفاتورة المعدلة
        function saveInvoice() {
            const clientName = document.getElementById('client-name').value;
            const clientAddress = document.getElementById('client-address').value;
            const clientPhone = document.getElementById('client-phone').value;
            
            if (!clientName) {
                showNotification('يرجى إدخال اسم العميل', 'error');
                return;
            }
            
            const productsData = [];
            const rows = document.querySelectorAll('#products-body tr');
            rows.forEach(row => {
                const productName = row.querySelector('.product-name').value;
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const discount = parseFloat(row.querySelector('.discount').value) || 0;
                const total = parseFloat(row.querySelector('.total').textContent) || 0;
                
                if (productName && quantity > 0 && price > 0) {
                    productsData.push({ productName, quantity, price, discount, total });
                }
            });
            
            if (productsData.length === 0) {
                showNotification('يرجى إضافة منتجات إلى الفاتورة', 'error');
                return;
            }
            
            let paymentData = {};
            const grandTotal = parseFloat(document.getElementById('grand-total').textContent) || 0;
            const previousBalance = parseFloat(document.getElementById('previous-balance').textContent) || 0;
            const totalDue = grandTotal + previousBalance;
            
            if (document.getElementById('enable-multiple-payments').checked) {
                const payments = [];
                let totalPaid = 0;
                document.querySelectorAll('.payment-row').forEach(row => {
                    const method = row.querySelector('.payment-method-select').value;
                    const amount = parseFloat(row.querySelector('.payment-amount').value) || 0;
                    if (amount > 0) {
                        payments.push({ method, amount });
                        totalPaid += amount;
                    }
                });
                paymentData = { type: 'multiple', payments, paidAmount: totalPaid, remainingBalance: totalDue - totalPaid };
            } else {
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                const paidAmount = parseFloat(document.getElementById('paid-amount').value) || 0;
                paymentData = { type: 'single', method: paymentMethod, paidAmount, remainingBalance: totalDue - paidAmount };
            }
            
            const selectedDate = document.getElementById('invoice-date-input').value;
            const invoiceDate = selectedDate ? new Date(selectedDate + 'T12:00:00').toISOString() : new Date().toISOString();
            
            const invoice = {
                id: generateInvoiceId(),
                date: invoiceDate,
                client: { name: clientName, address: clientAddress, phone: clientPhone },
                products: productsData,
                subtotal: parseFloat(document.getElementById('subtotal').textContent) || 0,
                totalDiscount: parseFloat(document.getElementById('total-discount').textContent) || 0,
                totalTax: parseFloat(document.getElementById('total-tax').textContent) || 0,
                grandTotal: grandTotal,
                payment: paymentData,
                status: paymentData.remainingBalance > 0 ? 'غير مدفوعة بالكامل' : 'مدفوعة'
            };
            
            productsData.forEach(product => {
                addToPurchaseHistory(product.productName, product.quantity, product.price, clientName, invoice.id);
            });
            
            invoices.push(invoice);
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            updateClientBalance(clientName, paymentData.remainingBalance);
            
            showNotification('تم حفظ الفاتورة بنجاح');
            
            resetInvoiceForm();
            
            loadReports();
            updateDashboard();
        }

        // دالة تعديل الفاتورة (معدلة)
        function editInvoice(invoiceId) {
            const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
            if (invoiceIndex === -1) {
                showNotification('لم يتم العثور على الفاتورة', 'error');
                return;
            }
            
            const invoice = invoices[invoiceIndex];
            
            // حذف سجلات المشتريات المرتبطة بهذه الفاتورة
            deletePurchaseHistoryByInvoiceId(invoiceId);
            
            document.querySelector('.tab[data-tab="invoice"]').click();
            
            document.getElementById('client-name').value = invoice.client.name;
            document.getElementById('client-address').value = invoice.client.address || '';
            document.getElementById('client-phone').value = invoice.client.phone || '';
            
            const invoiceDate = new Date(invoice.date);
            const year = invoiceDate.getFullYear();
            const month = String(invoiceDate.getMonth() + 1).padStart(2, '0');
            const day = String(invoiceDate.getDate()).padStart(2, '0');
            document.getElementById('invoice-date-input').value = `${year}-${month}-${day}`;
            updateDatesFromInput();
            
            document.getElementById('products-body').innerHTML = '';
            productCount = 0;
            invoice.products.forEach(product => {
                addProductRow();
                const lastRow = document.querySelector('#products-body tr:last-child');
                lastRow.querySelector('.product-name').value = product.productName;
                lastRow.querySelector('.quantity').value = product.quantity;
                lastRow.querySelector('.price').value = product.price;
                lastRow.querySelector('.discount').value = product.discount;
                calculateRowTotal(lastRow);
            });
            
            if (invoice.payment.type === 'multiple') {
                document.getElementById('enable-multiple-payments').checked = true;
                document.getElementById('multiple-payments-section').style.display = 'block';
                document.getElementById('single-payment-section').style.display = 'none';
                
                document.getElementById('multiple-payments-section').innerHTML = '';
                
                invoice.payment.payments.forEach(payment => {
                    const paymentRow = document.createElement('div');
                    paymentRow.className = 'payment-row';
                    paymentRow.innerHTML = `
                        <select class="payment-method-select">
                            <option value="cash" ${payment.method === 'cash' ? 'selected' : ''}>كاش</option>
                            <option value="check" ${payment.method === 'check' ? 'selected' : ''}>شيكات</option>
                            <option value="exchange" ${payment.method === 'exchange' ? 'selected' : ''}>تبديل بضائع</option>
                            <option value="bank" ${payment.method === 'bank' ? 'selected' : ''}>تحويل بنكي</option>
                        </select>
                        <input type="number" class="payment-amount" placeholder="المبلغ" min="0" step="0.01" value="${payment.amount}">
                        <button class="btn btn-danger remove-payment">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    `;
                    document.getElementById('multiple-payments-section').appendChild(paymentRow);
                });
                
                const addButton = document.createElement('button');
                addButton.className = 'btn';
                addButton.id = 'add-payment-method';
                addButton.innerHTML = '<i class="fas fa-plus"></i> إضافة طريقة دفع أخرى';
                document.getElementById('multiple-payments-section').appendChild(addButton);
                
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'payment-summary';
                summaryDiv.innerHTML = `<strong>إجمالي المدفوع:</strong> <span id="total-paid">${invoice.payment.paidAmount.toFixed(2)}</span> دينار`;
                document.getElementById('multiple-payments-section').appendChild(summaryDiv);
                
                setupMultiplePayments();
            } else {
                document.getElementById('enable-multiple-payments').checked = false;
                document.getElementById('multiple-payments-section').style.display = 'none';
                document.getElementById('single-payment-section').style.display = 'block';
                document.querySelector(`input[name="payment-method"][value="${invoice.payment.method}"]`).checked = true;
                document.getElementById('paid-amount').value = invoice.payment.paidAmount;
            }
            
            calculateTotals();
            updatePaymentBalance();
            
            invoices.splice(invoiceIndex, 1);
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            showNotification('يمكنك الآن تعديل الفاتورة');
        }

        // دالة لإعادة تعيين نموذج الفاتورة
        function resetInvoiceForm() {
            document.getElementById('products-body').innerHTML = '';
            document.getElementById('client-name').value = '';
            document.getElementById('client-address').value = '';
            document.getElementById('client-phone').value = '';
            document.getElementById('paid-amount').value = '0.00';
            document.getElementById('client-balance-info').style.display = 'none';
            updateTotals(0, 0, 0, 0);
            updatePaymentBalance();
            productCount = 0;
            addProductRow();
            setDefaultDates();
            
            document.getElementById('enable-multiple-payments').checked = false;
            document.getElementById('multiple-payments-section').style.display = 'none';
            document.getElementById('single-payment-section').style.display = 'block';
            document.getElementById('multiple-payments-section').innerHTML = `
                <div class="payment-row">
                    <select class="payment-method-select">
                        <option value="cash">كاش</option>
                        <option value="check">شيكات</option>
                        <option value="exchange">تبديل بضائع</option>
                        <option value="bank">تحويل بنكي</option>
                    </select>
                    <input type="number" class="payment-amount" placeholder="المبلغ" min="0" step="0.01">
                    <button class="btn btn-danger remove-payment">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                </div>
                <button class="btn" id="add-payment-method">
                    <i class="fas fa-plus"></i> إضافة طريقة دفع أخرى
                </button>
                <div class="payment-summary">
                    <strong>إجمالي المدفوع:</strong> <span id="total-paid">0.00</span> دينار
                </div>
            `;
            setupMultiplePayments();
        }
        
        // دالة لإعداد الدفعات المتعددة
        function setupMultiplePayments() {
            document.getElementById('add-payment-method').addEventListener('click', function() {
                const paymentSection = document.getElementById('multiple-payments-section');
                const paymentRow = document.createElement('div');
                paymentRow.className = 'payment-row';
                paymentRow.innerHTML = `
                    <select class="payment-method-select">
                        <option value="cash">كاش</option>
                        <option value="check">شيكات</option>
                        <option value="exchange">تبديل بضائع</option>
                        <option value="bank">تحويل بنكي</option>
                    </select>
                    <input type="number" class="payment-amount" placeholder="المبلغ" min="0" step="0.01">
                    <button class="btn btn-danger remove-payment">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                `;
                
                paymentSection.insertBefore(paymentRow, this);
                
                paymentRow.querySelector('.remove-payment').addEventListener('click', function() {
                    paymentRow.remove();
                    updateMultiplePaymentsTotal();
                });
                
                paymentRow.querySelector('.payment-amount').addEventListener('input', function() {
                    updateMultiplePaymentsTotal();
                });
            });
            
            const firstPaymentRow = document.querySelector('.payment-row');
            if (firstPaymentRow) {
                firstPaymentRow.querySelector('.remove-payment').addEventListener('click', function() {
                    if (document.querySelectorAll('.payment-row').length > 1) {
                        firstPaymentRow.remove();
                        updateMultiplePaymentsTotal();
                    } else {
                        showNotification('يجب أن تبقى طريقة دفع واحدة على الأقل', 'error');
                    }
                });
                
                firstPaymentRow.querySelector('.payment-amount').addEventListener('input', function() {
                    updateMultiplePaymentsTotal();
                });
            }
        }
        
        // دالة لتحديث إجمالي الدفعات المتعددة
        function updateMultiplePaymentsTotal() {
            let total = 0;
            document.querySelectorAll('.payment-amount').forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            document.getElementById('total-paid').textContent = total.toFixed(2);
            updatePaymentBalance();
        }
        
        // دالة لإضافة صف منتج جديد
        function addProductRow() {
            productCount++;
            const tbody = document.getElementById('products-body');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${productCount}</td>
                <td>
                    <div class="product-select">
                        <select class="product-name">
                            <option value="">اختر منتج</option>
                            ${baseProducts.map(product => `<option value="${product}">${product}</option>`).join('')}
                        </select>
                    </div>
                </td>
                <td><input type="number" class="quantity" value="1" min="1"></td>
                <td><input type="number" class="price" value="0.00" min="0" step="0.01" placeholder="السعر شامل الضريبة"></td>
                <td><input type="number" class="discount" value="0" min="0" max="100"></td>
                <td class="total">0.00</td>
                <td class="no-print">
                    <button class="btn btn-danger remove-product">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                </td>
            `;
            tbody.appendChild(row);
            
            const inputs = row.querySelectorAll('.quantity, .price, .discount, .product-name');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    calculateRowTotal(this.closest('tr'));
                    calculateTotals();
                    updatePaymentBalance();
                });
            });
            
            row.querySelector('.remove-product').addEventListener('click', function() {
                row.remove();
                renumberRows();
                calculateTotals();
                updatePaymentBalance();
            });
            
            calculateRowTotal(row);
        }
        
        // دالة لحساب المجموع لكل صف
        function calculateRowTotal(row) {
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const price = parseFloat(row.querySelector('.price').value) || 0;
            const discount = parseFloat(row.querySelector('.discount').value) || 0;
            
            const discountAmount = (price * discount) / 100;
            const priceAfterDiscount = price - discountAmount;
            const total = priceAfterDiscount * quantity;
            
            row.querySelector('.total').textContent = total.toFixed(2);
        }
        
        // دالة لإعادة ترقيم الصفوف بعد الحذف
        function renumberRows() {
            const rows = document.querySelectorAll('#products-body tr');
            productCount = 0;
            rows.forEach(row => {
                productCount++;
                row.cells[0].textContent = productCount;
            });
        }
        
        // دالة لحساب المجاميع الكلية
        function calculateTotals() {
            let subtotal = 0;
            let totalDiscount = 0;
            let totalTax = 0;
            let grandTotal = 0;
            
            const rows = document.querySelectorAll('#products-body tr');
            rows.forEach(row => {
                calculateRowTotal(row);
                
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const discount = parseFloat(row.querySelector('.discount').value) || 0;
                
                const rowSubtotal = price * quantity;
                const discountAmount = (rowSubtotal * discount) / 100;
                const priceAfterDiscount = rowSubtotal - discountAmount;
                
                const taxRate = 16;
                const taxAmount = (priceAfterDiscount * taxRate) / (100 + taxRate);
                
                subtotal += rowSubtotal;
                totalDiscount += discountAmount;
                totalTax += taxAmount;
                grandTotal += priceAfterDiscount;
            });
            
            updateTotals(subtotal, totalDiscount, totalTax, grandTotal);
        }
        
        // دالة لتحديث القيم في قسم المجاميع
        function updateTotals(subtotal, totalDiscount, totalTax, grandTotal) {
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('total-discount').textContent = totalDiscount.toFixed(2);
            document.getElementById('total-tax').textContent = totalTax.toFixed(2);
            document.getElementById('grand-total').textContent = grandTotal.toFixed(2);
        }
        
        // دالة لتحديث رصيد الدفع
        function updatePaymentBalance() {
            const grandTotal = parseFloat(document.getElementById('grand-total').textContent) || 0;
            const previousBalance = parseFloat(document.getElementById('previous-balance').textContent) || 0;
            
            const totalDue = grandTotal + previousBalance;
            let paidAmount = 0;
            
            if (document.getElementById('enable-multiple-payments').checked) {
                paidAmount = parseFloat(document.getElementById('total-paid').textContent) || 0;
            } else {
                paidAmount = parseFloat(document.getElementById('paid-amount').value) || 0;
            }
            
            const remainingBalance = totalDue - paidAmount;
            
            document.getElementById('balance-amount').textContent = Math.max(0, remainingBalance).toFixed(2);
            
            if (remainingBalance > 0) {
                document.getElementById('remaining-balance').style.color = '#e74c3c';
            } else {
                document.getElementById('remaining-balance').style.color = '#27ae60';
            }
        }
        
        // دالة لتحديث رصيد العميل
        function updateClientBalance(clientName, balanceChange) {
            let client = clients.find(c => c.name === clientName);
            
            if (!client) {
                client = {
                    id: Date.now().toString(),
                    name: clientName,
                    address: document.getElementById('client-address').value || '',
                    phone: document.getElementById('client-phone').value || '',
                    balance: balanceChange,
                    createdAt: new Date().toISOString(),
                    payments: []
                };
                clients.push(client);
            } else {
                client.balance = (client.balance || 0) + balanceChange;
            }
            
            localStorage.setItem('clients', JSON.stringify(clients));
        }
        
        // دالة لإنشاء معرف فاتورة فريد
        function generateInvoiceId() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const time = String(now.getTime()).slice(-4);
            return `INV-${year}${month}${day}-${time}`;
        }
        
        // دالة للبحث التلقائي عن العملاء
        function autocompleteClient(searchTerm) {
            const autocompleteList = document.getElementById('client-autocomplete-list');
            autocompleteList.innerHTML = '';
            
            if (searchTerm.length < 2) return;
            
            const filteredClients = clients.filter(client => 
                client.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            filteredClients.forEach(client => {
                const item = document.createElement('div');
                item.textContent = client.name;
                item.addEventListener('click', function() {
                    document.getElementById('client-search').value = client.name;
                    autocompleteList.innerHTML = '';
                    
                    document.getElementById('client-name').value = client.name;
                    document.getElementById('client-address').value = client.address || '';
                    document.getElementById('client-phone').value = client.phone || '';
                    
                    document.getElementById('previous-balance').textContent = (client.balance || 0).toFixed(2);
                    document.getElementById('client-balance-info').style.display = 'block';
                    
                    updatePaymentBalance();
                });
                autocompleteList.appendChild(item);
            });
        }
        
        // دالة للبحث عن عميل
        function searchClient() {
            const searchTerm = document.getElementById('client-search').value;
            
            if (!searchTerm) {
                showNotification('يرجى إدخال اسم العميل للبحث', 'error');
                return;
            }
            
            const client = clients.find(c => c.name.toLowerCase().includes(searchTerm.toLowerCase()));
            
            if (client) {
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-address').value = client.address || '';
                document.getElementById('client-phone').value = client.phone || '';
                
                document.getElementById('previous-balance').textContent = (client.balance || 0).toFixed(2);
                document.getElementById('client-balance-info').style.display = 'block';
                
                updatePaymentBalance();
                
                showNotification('تم العثور على العميل');
            } else {
                showNotification('لم يتم العثور على العميل', 'error');
            }
        }
        
        // دالة لحفظ العميل
        function saveClient() {
            const name = document.getElementById('new-client-name').value;
            const address = document.getElementById('new-client-address').value;
            const phone = document.getElementById('new-client-phone').value;
            
            if (!name) {
                showNotification('يرجى إدخال اسم العميل', 'error');
                return;
            }
            
            if (clients.some(client => client.name === name)) {
                showNotification('هناك عميل مسجل بنفس الاسم', 'error');
                return;
            }
            
            const client = {
                id: Date.now().toString(),
                name,
                address,
                phone,
                balance: 0,
                createdAt: new Date().toISOString(),
                payments: []
            };
            
            clients.push(client);
            localStorage.setItem('clients', JSON.stringify(clients));
            
            showNotification('تم حفظ العميل بنجاح');
            
            document.getElementById('new-client-name').value = '';
            document.getElementById('new-client-address').value = '';
            document.getElementById('new-client-phone').value = '';
            
            loadClientsList();
            updateDashboard();
        }
        
        // دالة لتحميل قائمة العملاء
        function loadClientsList() {
            const clientList = document.getElementById('client-list');
            clientList.innerHTML = '';
            
            if (clients.length === 0) {
                clientList.innerHTML = '<div class="client-item">لا توجد عملاء مسجلين</div>';
                return;
            }
            
            clients.forEach(client => {
                const item = document.createElement('div');
                item.className = 'client-item';
                
                const balanceClass = client.balance > 0 ? 'balance-negative' : 
                                   client.balance < 0 ? 'balance-positive' : '';
                
                item.innerHTML = `
                    <div><strong>${client.name}</strong></div>
                    <div>${client.address || 'لا يوجد عنوان'}</div>
                    <div>${client.phone || 'لا يوجد هاتف'}</div>
                    <div class="client-financial-info ${balanceClass}">
                        الرصيد: ${(client.balance || 0).toFixed(2)} دينار
                        ${client.balance > 0 ? ' (مدين)' : client.balance < 0 ? ' (دائن)' : ''}
                    </div>
                    <button class="btn" style="margin-top: 10px; width: 100%;" data-client-name="${client.name}">
                        <i class="fas fa-eye"></i> عرض الفواتير والدفعات
                    </button>
                `;
                
                item.querySelector('button').addEventListener('click', function() {
                    const clientName = this.getAttribute('data-client-name');
                    viewClientInvoices(clientName);
                });
                
                clientList.appendChild(item);
            });
        }
        
        // دالة لعرض فواتير العميل
        function viewClientInvoices(clientName) {
            currentViewingClient = clientName;
            const clientInvoicesSection = document.getElementById('client-invoices-section');
            const clientInvoices = document.getElementById('client-invoices');
            const clientPayments = document.getElementById('client-payments');
            
            clientInvoicesSection.style.display = 'block';
            document.getElementById('current-client-name').textContent = clientName;
            
            const client = clients.find(c => c.name === clientName);
            if (client) {
                document.getElementById('current-client-balance').textContent = (client.balance || 0).toFixed(2);
                
                const clientInvoicesList = invoices.filter(invoice => invoice.client.name === clientName);
                const totalPurchases = clientInvoicesList.reduce((sum, invoice) => sum + invoice.grandTotal, 0);
                document.getElementById('total-client-purchases').textContent = totalPurchases.toFixed(2);
                
                const totalPayments = (client.payments || []).reduce((sum, payment) => sum + payment.amount, 0);
                document.getElementById('total-client-payments').textContent = totalPayments.toFixed(2);
                
                displayClientPayments(client);
            }
            
            const clientInvoicesList = invoices.filter(invoice => invoice.client.name === clientName);
            
            clientInvoices.innerHTML = '';
            
            if (clientInvoicesList.length === 0) {
                clientInvoices.innerHTML = '<p>لا توجد فواتير لهذا العميل</p>';
            } else {
                clientInvoicesList.forEach(invoice => {
                    const invoiceDiv = document.createElement('div');
                    invoiceDiv.className = 'invoice-item';
                    
                    let productsHTML = '';
                    invoice.products.forEach(product => {
                        productsHTML += `
                            <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 4px;">
                                ${product.productName} - ${product.quantity} × ${product.price.toFixed(2)} = ${product.total.toFixed(2)} دينار
                            </div>
                        `;
                    });
                    
                    let paymentHTML = '';
                    if (invoice.payment.type === 'multiple') {
                        paymentHTML = `
                            <div><strong>طرق الدفع:</strong></div>
                            ${invoice.payment.payments.map(payment => `
                                <div style="margin-right: 20px;">${getPaymentMethodText(payment.method)}: ${payment.amount.toFixed(2)} دينار</div>
                            `).join('')}
                        `;
                    } else {
                        paymentHTML = `
                            <div><strong>طريقة الدفع:</strong> ${getPaymentMethodText(invoice.payment.method)}</div>
                        `;
                    }
                    
                    invoiceDiv.innerHTML = `
                        <div class="invoice-header-small">
                            <div><strong>${invoice.id}</strong></div>
                            <div>${new Date(invoice.date).toLocaleDateString('ar-EG')}</div>
                        </div>
                        <div><strong>المنتجات المشتراة:</strong></div>
                        ${productsHTML}
                        <div class="total-section">
                            <div>المجموع الكلي: ${invoice.grandTotal.toFixed(2)} دينار</div>
                            ${paymentHTML}
                            <div>المبلغ المدفوع: ${invoice.payment.paidAmount.toFixed(2)} دينار</div>
                            <div>المبلغ المتبقي: ${invoice.payment.remainingBalance.toFixed(2)} دينار</div>
                            <div>الحالة: ${invoice.status}</div>
                        </div>
                        <button class="btn btn-secondary edit-invoice" data-invoice-id="${invoice.id}">
                            <i class="fas fa-edit"></i> تعديل الفاتورة
                        </button>
                    `;
                    
                    invoiceDiv.querySelector('.edit-invoice').addEventListener('click', function() {
                        editInvoice(invoice.id);
                    });
                    
                    clientInvoices.appendChild(invoiceDiv);
                });
            }
        }
        
        // دالة لعرض دفعات العميل
        function displayClientPayments(client) {
            const clientPayments = document.getElementById('client-payments');
            clientPayments.innerHTML = '';
            
            if (!client.payments || client.payments.length === 0) {
                clientPayments.innerHTML = '<p>لا توجد دفعات مسجلة</p>';
                return;
            }
            
            client.payments.forEach(payment => {
                const paymentDiv = document.createElement('div');
                paymentDiv.className = 'payment-item';
                paymentDiv.innerHTML = `
                    <div><strong>${new Date(payment.date).toLocaleDateString('ar-EG')}</strong></div>
                    <div>المبلغ: ${payment.amount.toFixed(2)} دينار</div>
                    <div>طريقة الدفع: ${getPaymentMethodText(payment.method)}</div>
                `;
                clientPayments.appendChild(paymentDiv);
            });
        }
        
        // دالة لإضافة دفعة
        function addPayment() {
            const amount = parseFloat(document.getElementById('payment-amount').value) || 0;
            const method = document.getElementById('payment-method-select').value;
            
            if (amount <= 0) {
                showNotification('يرجى إدخال مبلغ صحيح', 'error');
                return;
            }
            
            if (!currentViewingClient) {
                showNotification('لم يتم تحديد عميل', 'error');
                return;
            }
            
            const client = clients.find(c => c.name === currentViewingClient);
            if (!client) {
                showNotification('لم يتم العثور على العميل', 'error');
                return;
            }
            
            const payment = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                amount: amount,
                method: method
            };
            
            if (!client.payments) {
                client.payments = [];
            }
            
            client.payments.push(payment);
            
            client.balance = (client.balance || 0) - amount;
            
            localStorage.setItem('clients', JSON.stringify(clients));
            
            showNotification('تم إضافة الدفعة بنجاح');
            
            document.getElementById('payment-form').style.display = 'none';
            document.getElementById('payment-amount').value = '0.00';
            
            viewClientInvoices(currentViewingClient);
        }
        
        // دالة لتصفية العملاء
        function filterClients(searchTerm) {
            const clientItems = document.querySelectorAll('.client-item');
            
            clientItems.forEach(item => {
                const clientName = item.querySelector('strong').textContent;
                if (clientName.toLowerCase().includes(searchTerm.toLowerCase())) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // دالة للبحث في سجل الفواتير
        function searchInvoicesHistory() {
            const searchTerm = document.getElementById('history-client-search').value;
            
            if (!searchTerm) {
                loadInvoicesHistory();
                return;
            }
            
            const filteredInvoices = invoices.filter(invoice => 
                invoice.client.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            displayInvoicesHistory(filteredInvoices);
        }
        
        // دالة لتحميل سجل الفواتير
        function loadInvoicesHistory() {
            displayInvoicesHistory(invoices);
        }
        
        // دالة لعرض سجل الفواتير
        function displayInvoicesHistory(invoicesList) {
            const invoicesHistory = document.getElementById('invoices-history');
            invoicesHistory.innerHTML = '';
            
            if (invoicesList.length === 0) {
                invoicesHistory.innerHTML = '<p>لا توجد فواتير مسجلة</p>';
                return;
            }
            
            invoicesList.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            invoicesList.forEach(invoice => {
                const invoiceDiv = document.createElement('div');
                invoiceDiv.className = 'invoice-item';
                
                let productsHTML = '';
                invoice.products.forEach(product => {
                    productsHTML += `
                        <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 4px;">
                            ${product.productName} - ${product.quantity} × ${product.price.toFixed(2)} = ${product.total.toFixed(2)} دينار
                        </div>
                    `;
                });
                
                invoiceDiv.innerHTML = `
                    <div class="invoice-header-small">
                        <div><strong>${invoice.id}</strong></div>
                        <div>${new Date(invoice.date).toLocaleDateString('ar-EG')}</div>
                    </div>
                    <div><strong>العميل:</strong> ${invoice.client.name}</div>
                    <div><strong>المنتجات المشتراة:</strong></div>
                    ${productsHTML}
                    <div class="total-section">
                        <div>المجموع الكلي: ${invoice.grandTotal.toFixed(2)} دينار</div>
                        <div>الحالة: ${invoice.status}</div>
                    </div>
                    <button class="btn btn-secondary edit-invoice" data-invoice-id="${invoice.id}">
                        <i class="fas fa-edit"></i> تعديل الفاتورة
                    </button>
                `;
                
                invoiceDiv.querySelector('.edit-invoice').addEventListener('click', function() {
                    editInvoice(invoice.id);
                });
                
                invoicesHistory.appendChild(invoiceDiv);
            });
        }
        
        // دالة للبحث في سجل المشتريات
        function searchPurchaseHistory() {
            const searchTerm = document.getElementById('purchase-client-search').value;
            
            if (!searchTerm) {
                loadPurchaseHistory();
                return;
            }
            
            const filteredPurchases = purchaseHistory.filter(purchase => 
                purchase.clientName.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            displayPurchaseHistory(filteredPurchases);
        }
        
        // دالة لتحميل سجل المشتريات
        function loadPurchaseHistory() {
            displayPurchaseHistory(purchaseHistory);
        }
        
        // دالة لعرض سجل المشتريات
        function displayPurchaseHistory(purchasesList) {
            const purchaseHistoryDiv = document.getElementById('purchase-history');
            purchaseHistoryDiv.innerHTML = '';
            
            if (purchasesList.length === 0) {
                purchaseHistoryDiv.innerHTML = '<p>لا توجد مشتريات مسجلة</p>';
                return;
            }
            
            purchasesList.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            purchasesList.forEach(purchase => {
                const purchaseDiv = document.createElement('div');
                purchaseDiv.className = 'invoice-item';
                purchaseDiv.innerHTML = `
                    <div class="invoice-header-small">
                        <div><strong>${purchase.clientName}</strong></div>
                        <div>${new Date(purchase.date).toLocaleDateString('ar-EG')}</div>
                    </div>
                    <div><strong>المنتج:</strong> ${purchase.productName}</div>
                    <div><strong>الكمية:</strong> ${purchase.quantity}</div>
                    <div><strong>السعر:</strong> ${purchase.price.toFixed(2)} دينار</div>
                    <div class="total-section">
                        <div>المجموع: ${purchase.total.toFixed(2)} دينار</div>
                    </div>
                `;
                
                purchaseHistoryDiv.appendChild(purchaseDiv);
            });
        }
        
        // دالة لتحميل إجمالي المشتريات حسب السماكة
        function loadSteelThicknessPurchases() {
            const steelThicknessPurchases = document.getElementById('steel-thickness-purchases');
            
            if (purchaseHistory.length === 0) {
                steelThicknessPurchases.innerHTML = '<p>لا توجد مشتريات مسجلة</p>';
                return;
            }
            
            const thicknessTotals = {};
            purchaseHistory.forEach(purchase => {
                const thicknessMatch = purchase.productName.match(/(\d+\.?\d*)\s*مم/);
                if (thicknessMatch) {
                    const thickness = thicknessMatch[1];
                    const key = `${thickness} مم`;
                    
                    if (!thicknessTotals[key]) {
                        thicknessTotals[key] = { quantity: 0, total: 0 };
                    }
                    thicknessTotals[key].quantity += purchase.quantity;
                    thicknessTotals[key].total += purchase.total;
                }
            });
            
            let html = '<table><thead><tr><th>السماكة</th><th>الكمية الإجمالية</th><th>القيمة الإجمالية</th></tr></thead><tbody>';
            
            for (const key in thicknessTotals) {
                html += `
                    <tr>
                        <td>${key}</td>
                        <td>${thicknessTotals[key].quantity}</td>
                        <td>${thicknessTotals[key].total.toFixed(2)} دينار</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            steelThicknessPurchases.innerHTML = html;
        }
        
        // دالة لتحميل إجمالي المشتريات
        function loadTotalPurchases() {
            const totalPurchases = document.getElementById('total-purchases');
            
            if (purchaseHistory.length === 0) {
                totalPurchases.innerHTML = '<p>لا توجد مشتريات مسجلة</p>';
                return;
            }
            
            const productTotals = {};
            purchaseHistory.forEach(purchase => {
                if (!productTotals[purchase.productName]) {
                    productTotals[purchase.productName] = { quantity: 0, total: 0 };
                }
                productTotals[purchase.productName].quantity += purchase.quantity;
                productTotals[purchase.productName].total += purchase.total;
            });
            
            let html = '<table><thead><tr><th>القطعة</th><th>الكمية الإجمالية</th><th>القيمة الإجمالية</th></tr></thead><tbody>';
            
            for (const productName in productTotals) {
                html += `
                    <tr>
                        <td>${productName}</td>
                        <td>${productTotals[productName].quantity}</td>
                        <td>${productTotals[productName].total.toFixed(2)} دينار</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            totalPurchases.innerHTML = html;
        }
        
        // دالة للحصول على نص طريقة الدفع
        function getPaymentMethodText(method) {
            switch(method) {
                case 'cash': return 'كاش';
                case 'check': return 'شيكات';
                case 'exchange': return 'تبديل بضائع';
                case 'bank': return 'تحويل بنكي';
                default: return method;
            }
        }
        
        // دالة لعرض الإشعارات
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // دالة لتحميل المخزون
        function loadInventory() {
            const inventoryGrid = document.getElementById('inventory-grid');
            inventoryGrid.innerHTML = '';
            
            const allInventory = [...inventory, ...oldInventory];
            
            if (allInventory.length === 0) {
                inventoryGrid.innerHTML = '<p>لا توجد بضائع في المخزون</p>';
                return;
            }
            
            allInventory.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'inventory-item';
                const isOld = oldInventory.includes(item);
                
                itemDiv.innerHTML = `
                    <h4>${item.name} ${isOld ? '(قديم)' : ''}</h4>
                    ${item.thickness ? `<div class="thickness">السماكة: ${item.thickness} مم</div>` : ''}
                    ${item.price > 0 ? `<div class="price">${item.price.toFixed(2)} دينار</div>` : ''}
                    <div class="quantity ${item.quantity < 20 ? 'stock-alert' : ''}">الكمية: ${item.quantity}</div>
                    <div class="inventory-actions">
                        <button class="btn btn-warning edit-inventory" data-id="${item.id}">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-danger delete-inventory" data-id="${item.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                
                itemDiv.querySelector('.edit-inventory').addEventListener('click', function() {
                    editInventoryItem(item.id);
                });
                
                itemDiv.querySelector('.delete-inventory').addEventListener('click', function() {
                    deleteInventoryItem(item.id);
                });
                
                inventoryGrid.appendChild(itemDiv);
            });
        }
        
        // دالة لتعديل عنصر في المخزون
        function editInventoryItem(itemId) {
            let item = inventory.find(item => item.id === itemId);
            let isOld = false;
            
            if (!item) {
                item = oldInventory.find(item => item.id === itemId);
                isOld = true;
            }
            
            if (!item) {
                showNotification('لم يتم العثور على العنصر', 'error');
                return;
            }
            
            editingInventoryItem = { item, isOld };
            
            document.getElementById('edit-product-name').value = item.name;
            document.getElementById('edit-product-thickness').value = item.thickness || '';
            document.getElementById('edit-product-quantity').value = item.quantity;
            document.getElementById('edit-product-price').value = item.price || 0;
            
            document.getElementById('edit-inventory-form').style.display = 'block';
        }
        
        // دالة لحفظ تعديل المخزون
        function saveEditInventory() {
            if (!editingInventoryItem) {
                showNotification('لم يتم تحديد عنصر للتعديل', 'error');
                return;
            }
            
            const name = document.getElementById('edit-product-name').value;
            const thickness = parseFloat(document.getElementById('edit-product-thickness').value) || null;
            const quantity = parseInt(document.getElementById('edit-product-quantity').value) || 0;
            const price = parseFloat(document.getElementById('edit-product-price').value) || 0;
            
            if (!name) {
                showNotification('يرجى إدخال اسم البضاعة', 'error');
                return;
            }
            
            if (quantity < 0) {
                showNotification('يرجى إدخال كمية صحيحة', 'error');
                return;
            }
            
            editingInventoryItem.item.name = name;
            editingInventoryItem.item.thickness = thickness;
            editingInventoryItem.item.quantity = quantity;
            editingInventoryItem.item.price = price;
            
            if (editingInventoryItem.isOld) {
                localStorage.setItem('oldInventory', JSON.stringify(oldInventory));
            } else {
                localStorage.setItem('inventory', JSON.stringify(inventory));
            }
            
            showNotification('تم تعديل البضاعة بنجاح');
            
            document.getElementById('edit-inventory-form').style.display = 'none';
            editingInventoryItem = null;
            loadInventory();
            populateWithdrawalProducts();
        }
        
        // دالة لحذف عنصر من المخزون
        function deleteInventoryItem(itemId) {
            if (!confirm('هل أنت متأكد من حذف هذه البضاعة؟')) {
                return;
            }
            
            let itemIndex = inventory.findIndex(item => item.id === itemId);
            let isOld = false;
            
            if (itemIndex === -1) {
                itemIndex = oldInventory.findIndex(item => item.id === itemId);
                isOld = true;
            }
            
            if (itemIndex === -1) {
                showNotification('لم يتم العثور على العنصر', 'error');
                return;
            }
            
            if (isOld) {
                oldInventory.splice(itemIndex, 1);
                localStorage.setItem('oldInventory', JSON.stringify(oldInventory));
            } else {
                inventory.splice(itemIndex, 1);
                localStorage.setItem('inventory', JSON.stringify(inventory));
            }
            
            showNotification('تم حذف البضاعة بنجاح');
            loadInventory();
            populateWithdrawalProducts();
        }
        
        // دالة لإضافة حديد جديد
        function addSteel() {
            const type = document.getElementById('steel-type').value;
            const thickness = parseFloat(document.getElementById('steel-thickness').value);
            const quantity = parseInt(document.getElementById('steel-quantity').value) || 0;
            const price = parseFloat(document.getElementById('steel-price').value) || 0;
            
            if (!thickness || thickness <= 0) {
                showNotification('يرجى إدخال سماكة صحيحة', 'error');
                return;
            }
            
            if (quantity <= 0) {
                showNotification('يرجى إدخال كمية صحيحة', 'error');
                return;
            }
            
            const steelItem = {
                id: Date.now().toString(),
                name: type,
                thickness: thickness,
                quantity: quantity,
                price: price,
                type: 'steel'
            };
            
            inventory.push(steelItem);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            
            showNotification('تم إضافة الحديد إلى المخزون بنجاح');
            
            document.getElementById('steel-thickness').value = '';
            document.getElementById('steel-quantity').value = '1';
            document.getElementById('steel-price').value = '0.00';
            
            loadInventory();
            populateWithdrawalProducts();
        }
        
        // دالة لإضافة بضاعة قديمة
        function addOldProduct() {
            const name = document.getElementById('old-product-name').value;
            const quantity = parseInt(document.getElementById('old-product-quantity').value) || 0;
            const price = parseFloat(document.getElementById('old-product-price').value) || 0;
            
            if (!name) {
                showNotification('يرجى إدخال اسم البضاعة', 'error');
                return;
            }
            
            if (quantity <= 0) {
                showNotification('يرجى إدخال كمية صحيحة', 'error');
                return;
            }
            
            const oldProduct = {
                id: Date.now().toString(),
                name: name,
                quantity: quantity,
                price: price,
                type: 'old'
            };
            
            oldInventory.push(oldProduct);
            localStorage.setItem('oldInventory', JSON.stringify(oldInventory));
            
            showNotification('تم إضافة البضاعة القديمة بنجاح');
            
            document.getElementById('old-product-name').value = '';
            document.getElementById('old-product-quantity').value = '1';
            document.getElementById('old-product-price').value = '0.00';
            
            loadInventory();
            populateWithdrawalProducts();
        }
        
        // دالة لتحميل المسحوبات
        function loadWithdrawals() {
            const withdrawalsBody = document.getElementById('withdrawals-body');
            withdrawalsBody.innerHTML = '';
            
            if (withdrawals.length === 0) {
                withdrawalsBody.innerHTML = '<tr><td colspan="5">لا توجد مسحوبات مسجلة</td></tr>';
                return;
            }
            
            withdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(withdrawal.date).toLocaleDateString('ar-EG')}</td>
                    <td>${withdrawal.recipient}</td>
                    <td>${withdrawal.product}</td>
                    <td>${withdrawal.quantity}</td>
                    <td class="no-print">
                        <button class="btn btn-danger remove-withdrawal" data-id="${withdrawal.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </td>
                `;
                
                withdrawalsBody.appendChild(row);
            });
            
            document.querySelectorAll('.remove-withdrawal').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    if (confirm('هل تريد حذف هذه المسحوبات؟')) {
                        withdrawals = withdrawals.filter(w => w.id !== id);
                        localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                        loadWithdrawals();
                        showNotification('تم حذف المسحوبات');
                    }
                });
            });
        }
        
        // دالة لتعبئة قائمة المنتجات في المسحوبات
        function populateWithdrawalProducts() {
            const withdrawalProduct = document.getElementById('withdrawal-product');
            withdrawalProduct.innerHTML = '<option value="">اختر البضاعة</option>';
            
            const allInventory = [...inventory, ...oldInventory];
            
            allInventory.forEach(item => {
                const option = document.createElement('option');
                const displayName = item.thickness ? `${item.name} ${item.thickness} مم` : item.name;
                option.value = displayName;
                option.textContent = displayName;
                option.setAttribute('data-id', item.id);
                withdrawalProduct.appendChild(option);
            });
        }
        
        // دالة لحفظ المسحوبات
        function saveWithdrawal() {
            const recipient = document.getElementById('withdrawal-recipient').value;
            const product = document.getElementById('withdrawal-product').value;
            const quantity = parseInt(document.getElementById('withdrawal-quantity').value) || 0;
            
            if (!recipient || !product || quantity <= 0) {
                showNotification('يرجى تعبئة جميع الحقول بشكل صحيح', 'error');
                return;
            }
            
            const allInventory = [...inventory, ...oldInventory];
            const inventoryItem = allInventory.find(item => {
                const displayName = item.thickness ? `${item.name} ${item.thickness} مم` : item.name;
                return displayName === product;
            });
            
            if (!inventoryItem || inventoryItem.quantity < quantity) {
                showNotification('الكمية المطلوبة غير متوفرة في المخزون', 'error');
                return;
            }
            
            inventoryItem.quantity -= quantity;
            
            if (inventoryItem.type === 'old') {
                localStorage.setItem('oldInventory', JSON.stringify(oldInventory));
            } else {
                localStorage.setItem('inventory', JSON.stringify(inventory));
            }
            
            const withdrawal = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                recipient,
                product,
                quantity
            };
            
            withdrawals.push(withdrawal);
            localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
            
            showNotification('تم تسجيل المسحوبات بنجاح');
            
            document.getElementById('withdrawal-recipient').value = '';
            document.getElementById('withdrawal-product').value = '';
            document.getElementById('withdrawal-quantity').value = '1';
            
            loadInventory();
            loadWithdrawals();
        }
        
        // دالة لحساب الراتب
        function calculateSalary() {
            const basicSalary = parseFloat(document.getElementById('employee-salary').value) || 0;
            const overtime = parseFloat(document.getElementById('employee-overtime').value) || 0;
            const deductions = parseFloat(document.getElementById('employee-deductions').value) || 0;
            
            const netSalary = basicSalary + overtime - deductions;
            
            document.getElementById('basic-salary').textContent = basicSalary.toFixed(2);
            document.getElementById('overtime-amount').textContent = overtime.toFixed(2);
            document.getElementById('deductions-amount').textContent = deductions.toFixed(2);
            document.getElementById('net-salary').textContent = netSalary.toFixed(2);
            
            document.getElementById('salary-result').style.display = 'block';
        }
        
        // دالة لطباعة كشف الراتب
        function printSalary() {
            document.getElementById('invoice-date').textContent = new Date().toLocaleDateString('en-US');
            document.getElementById('hijri-date').textContent = getHijriDate();
            
            const printWindow = window.open('', '_blank');
            const employeeName = document.getElementById('employee-name').value || 'غير محدد';
            const employeeId = document.getElementById('employee-id').value || 'غير محدد';
            const employeePosition = document.getElementById('employee-position').value || 'غير محدد';
            const month = document.getElementById('employee-month').options[document.getElementById('employee-month').selectedIndex].text;
            const year = document.getElementById('employee-year').value;
            
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>كشف راتب - ${employeeName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px double #000; padding: 20px; }
                        .header h1 { margin: 0; font-size: 32px; color: #2c3e50; }
                        .header h2 { margin: 10px 0; font-size: 24px; color: #34495e; }
                        .english-title { font-size: 20px; color: #7f8c8d; }
                        .employee-info { margin: 20px 0; padding: 15px; border: 2px solid #000; }
                        .salary-details { margin: 20px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        th, td { border: 1px solid #000; padding: 10px; text-align: center; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        .total { font-weight: bold; font-size: 18px; border-top: 2px solid #000; padding-top: 15px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>مصنع أحمد العاروري</h1>
                        <h2>لصناعة أكسسوارات الديكور</h2>
                        <div class="english-title">FACTORY FOR DECORATION ACCESSORIES</div>
                    </div>
                    
                    <div class="employee-info">
                        <h3>كشف راتب الموظف</h3>
                        <p><strong>اسم الموظف:</strong> ${employeeName}</p>
                        <p><strong>رقم الهوية:</strong> ${employeeId}</p>
                        <p><strong>المسمى الوظيفي:</strong> ${employeePosition}</p>
                        <p><strong>شهر:</strong> ${month} ${year}</p>
                        <p><strong>تاريخ الطباعة:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>
                    
                    <div class="salary-details">
                        <table>
                            <thead>
                                <tr>
                                    <th>البند</th>
                                    <th>المبلغ (دينار)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>الراتب الأساسي</td>
                                    <td>${document.getElementById('basic-salary').textContent}</td>
                                </tr>
                                <tr>
                                    <td>الإضافي</td>
                                    <td>${document.getElementById('overtime-amount').textContent}</td>
                                </tr>
                                <tr>
                                    <td>الخصومات</td>
                                    <td>${document.getElementById('deductions-amount').textContent}</td>
                                </tr>
                                <tr>
                                    <td><strong>صافي الراتب</strong></td>
                                    <td><strong>${document.getElementById('net-salary').textContent}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 50px;">
                        <p>توقيع الموظف: _________________________</p>
                        <p>توقيع المدير: _________________________</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        // دالة لحفظ كشف الراتب
        function saveSalary() {
            const employeeName = document.getElementById('employee-name').value;
            const employeeId = document.getElementById('employee-id').value;
            const employeePosition = document.getElementById('employee-position').value;
            const month = document.getElementById('employee-month').value;
            const year = document.getElementById('employee-year').value;
            const basicSalary = parseFloat(document.getElementById('employee-salary').value) || 0;
            const overtime = parseFloat(document.getElementById('employee-overtime').value) || 0;
            const deductions = parseFloat(document.getElementById('employee-deductions').value) || 0;
            const netSalary = basicSalary + overtime - deductions;
            
            if (!employeeName) {
                showNotification('يرجى إدخال اسم الموظف', 'error');
                return;
            }
            
            const salaryRecord = {
                id: Date.now().toString(),
                employeeName,
                employeeId,
                employeePosition,
                month,
                year,
                basicSalary,
                overtime,
                deductions,
                netSalary,
                date: new Date().toISOString()
            };
            
            employeeSalaries.push(salaryRecord);
            localStorage.setItem('employeeSalaries', JSON.stringify(employeeSalaries));
            
            showNotification('تم حفظ كشف الراتب بنجاح');
            loadEmployeeSalaries();
        }
        
        // دالة لتحميل كشوف الرواتب المحفوظة
        function loadEmployeeSalaries() {
            const savedSalaries = document.getElementById('saved-salaries');
            savedSalaries.innerHTML = '';
            
            if (employeeSalaries.length === 0) {
                savedSalaries.innerHTML = '<p>لا توجد كشوف رواتب محفوظة</p>';
                return;
            }
            
            employeeSalaries.forEach(salary => {
                const salaryDiv = document.createElement('div');
                salaryDiv.className = 'invoice-item';
                const monthNames = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
                
                salaryDiv.innerHTML = `
                    <div class="invoice-header-small">
                        <div><strong>${salary.employeeName}</strong></div>
                        <div>${monthNames[parseInt(salary.month) - 1]} ${salary.year}</div>
                    </div>
                    <div class="client-details">
                        <div><strong>رقم الهوية:</strong> ${salary.employeeId || 'غير محدد'}</div>
                        <div><strong>المسمى الوظيفي:</strong> ${salary.employeePosition || 'غير محدد'}</div>
                    </div>
                    <div class="total-section">
                        <div>الراتب الأساسي: ${salary.basicSalary.toFixed(2)} دينار</div>
                        <div>الإضافي: ${salary.overtime.toFixed(2)} دينار</div>
                        <div>الخصومات: ${salary.deductions.toFixed(2)} دينار</div>
                        <div class="grand-total">صافي الراتب: ${salary.netSalary.toFixed(2)} دينار</div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-success print-salary-item" data-id="${salary.id}">
                            <i class="fas fa-print"></i> طباعة
                        </button>
                        <button class="btn btn-danger delete-salary" data-id="${salary.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                
                salaryDiv.querySelector('.print-salary-item').addEventListener('click', function() {
                    printSalaryItem(salary.id);
                });
                
                salaryDiv.querySelector('.delete-salary').addEventListener('click', function() {
                    deleteSalary(salary.id);
                });
                
                savedSalaries.appendChild(salaryDiv);
            });
        }
        
        // دالة لطباعة كشف راتب محفوظ
        function printSalaryItem(salaryId) {
            const salary = employeeSalaries.find(s => s.id === salaryId);
            if (!salary) return;
            
            const printWindow = window.open('', '_blank');
            const monthNames = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>كشف راتب - ${salary.employeeName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px double #000; padding: 20px; }
                        .header h1 { margin: 0; font-size: 32px; color: #2c3e50; }
                        .header h2 { margin: 10px 0; font-size: 24px; color: #34495e; }
                        .english-title { font-size: 20px; color: #7f8c8d; }
                        .employee-info { margin: 20px 0; padding: 15px; border: 2px solid #000; }
                        .salary-details { margin: 20px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        th, td { border: 1px solid #000; padding: 10px; text-align: center; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        .total { font-weight: bold; font-size: 18px; border-top: 2px solid #000; padding-top: 15px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>مصنع أحمد العاروري</h1>
                        <h2>لصناعة أكسسوارات الديكور</h2>
                        <div class="english-title">FACTORY FOR DECORATION ACCESSORIES</div>
                    </div>
                    
                    <div class="employee-info">
                        <h3>كشف راتب الموظف</h3>
                        <p><strong>اسم الموظف:</strong> ${salary.employeeName}</p>
                        <p><strong>رقم الهوية:</strong> ${salary.employeeId || 'غير محدد'}</p>
                        <p><strong>المسمى الوظيفي:</strong> ${salary.employeePosition || 'غير محدد'}</p>
                        <p><strong>شهر:</strong> ${monthNames[parseInt(salary.month) - 1]} ${salary.year}</p>
                        <p><strong>تاريخ الطباعة:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>
                    
                    <div class="salary-details">
                        <table>
                            <thead>
                                <tr>
                                    <th>البند</th>
                                    <th>المبلغ (دينار)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>الراتب الأساسي</td>
                                    <td>${salary.basicSalary.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td>الإضافي</td>
                                    <td>${salary.overtime.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td>الخصومات</td>
                                    <td>${salary.deductions.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td><strong>صافي الراتب</strong></td>
                                    <td><strong>${salary.netSalary.toFixed(2)}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 50px;">
                        <p>توقيع الموظف: _________________________</p>
                        <p>توقيع المدير: _________________________</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        // دالة لحذف كشف راتب
        function deleteSalary(salaryId) {
            if (!confirm('هل أنت متأكد من حذف كشف الراتب هذا؟')) {
                return;
            }
            
            employeeSalaries = employeeSalaries.filter(s => s.id !== salaryId);
            localStorage.setItem('employeeSalaries', JSON.stringify(employeeSalaries));
            showNotification('تم حذف كشف الراتب');
            loadEmployeeSalaries();
        }
        
        // دالة لإعداد آلة الحاسبة
        function setupCalculator() {
            setupCalculatorInputs();
        }
        
        // دالة لإعداد حقول الإدخال للآلة الحاسبة
        function setupCalculatorInputs() {
            const calculationType = document.getElementById('calculation-type').value;
            const inputFields = document.getElementById('input-fields');
            inputFields.innerHTML = '';
            
            if (calculationType === '1') {
                inputFields.innerHTML = `
                    <div>
                        <strong>عرض الشريحة (سم):</strong>
                        <input type="number" id="sheet-width" placeholder="أدخل عرض الشريحة" step="0.1" min="0.1">
                    </div>
                    <div>
                        <strong>السماكة (مم):</strong>
                        <input type="number" id="sheet-thickness" placeholder="أدخل السماكة" step="0.1" min="0.1">
                    </div>
                `;
            } else if (calculationType === '2') {
                inputFields.innerHTML = `
                    <div>
                        <strong>عرض الشريحة (سم):</strong>
                        <input type="number" id="sheet-width" placeholder="أدخل عرض الشريحة" step="0.1" min="0.1">
                    </div>
                    <div>
                        <strong>الوزن (كجم):</strong>
                        <input type="number" id="sheet-weight" placeholder="أدخل الوزن" step="0.1" min="0.1">
                    </div>
                `;
            } else if (calculationType === '3') {
                inputFields.innerHTML = `
                    <div>
                        <strong>السماكة (مم):</strong>
                        <input type="number" id="sheet-thickness" placeholder="أدخل السماكة" step="0.1" min="0.1">
                    </div>
                    <div>
                        <strong>الوزن (كجم):</strong>
                        <input type="number" id="sheet-weight" placeholder="أدخل الوزن" step="0.1" min="0.1">
                    </div>
                `;
            }
        }
        
        // دالة لحساب الحديد
        function calculateSteel() {
            const calculationType = document.getElementById('calculation-type').value;
            let resultHTML = '';
            
            if (calculationType === '1') {
                const width = parseFloat(document.getElementById('sheet-width').value);
                const thickness = parseFloat(document.getElementById('sheet-thickness').value);
                
                if (!width || !thickness) {
                    showNotification('يرجى إدخال جميع القيم المطلوبة', 'error');
                    return;
                }
                
                const weight = width * thickness * 300 * 7.85;
                resultHTML = `
                    <p><strong>الوزن:</strong> ${weight.toFixed(2)} كجم</p>
                    <p><strong>عرض الشريحة:</strong> ${width} سم</p>
                    <p><strong>السماكة:</strong> ${thickness} مم</p>
                `;
            } else if (calculationType === '2') {
                const width = parseFloat(document.getElementById('sheet-width').value);
                const weight = parseFloat(document.getElementById('sheet-weight').value);
                
                if (!width || !weight) {
                    showNotification('يرجى إدخال جميع القيم المطلوبة', 'error');
                    return;
                }
                
                const c = width * 300 * 7.85;
                const thickness = weight / c;
                resultHTML = `
                    <p><strong>السماكة:</strong> ${thickness.toFixed(4)} مم</p>
                    <p><strong>عرض الشريحة:</strong> ${width} سم</p>
                    <p><strong>الوزن:</strong> ${weight} كجم</p>
                `;
            } else if (calculationType === '3') {
                const thickness = parseFloat(document.getElementById('sheet-thickness').value);
                const weight = parseFloat(document.getElementById('sheet-weight').value);
                
                if (!thickness || !weight) {
                    showNotification('يرجى إدخال جميع القيم المطلوبة', 'error');
                    return;
                }
                
                const v = thickness * 300 * 7.85;
                const width = weight / v;
                resultHTML = `
                    <p><strong>عرض الشريحة:</strong> ${width.toFixed(2)} سم</p>
                    <p><strong>السماكة:</strong> ${thickness} مم</p>
                    <p><strong>الوزن:</strong> ${weight} كجم</p>
                `;
            }
            
            document.getElementById('result-details').innerHTML = resultHTML;
            document.getElementById('calculator-result').style.display = 'block';
        }
        
        // دالة لإعادة تعيين الآلة الحاسبة
        function resetCalculator() {
            document.getElementById('input-fields').innerHTML = '';
            document.getElementById('calculator-result').style.display = 'none';
            setupCalculatorInputs();
        }
        
        // دالة لتحميل التقارير
        function loadReports() {
            loadDailyReport();
            loadWeeklyReport();
            loadMonthlyReport();
            loadAnnualReport();
        }
        
        // دالة لتحميل التقرير اليومي
        function loadDailyReport() {
            const today = new Date();
            const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
            
            const dailyInvoices = invoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= todayStart && invoiceDate < todayEnd;
            });
            
            const totalSales = dailyInvoices.reduce((sum, invoice) => sum + invoice.grandTotal, 0);
            const totalProducts = dailyInvoices.reduce((sum, invoice) => sum + invoice.products.length, 0);
            const totalUnits = dailyInvoices.reduce((sum, invoice) => sum + invoice.products.reduce((prodSum, product) => prodSum + product.quantity, 0), 0);
            const uniqueCustomers = [...new Set(dailyInvoices.map(invoice => invoice.client.name))].length;
            const avgInvoice = dailyInvoices.length > 0 ? totalSales / dailyInvoices.length : 0;
            
            document.getElementById('daily-total-sales').textContent = totalSales.toFixed(2) + ' دينار';
            document.getElementById('daily-invoices-count').textContent = dailyInvoices.length + ' فاتورة';
            document.getElementById('daily-products-sold').textContent = totalProducts + ' منتج';
            document.getElementById('daily-units-sold').textContent = totalUnits + ' وحدة';
            document.getElementById('daily-avg-invoice').textContent = avgInvoice.toFixed(2) + ' دينار';
            document.getElementById('daily-customers-count').textContent = uniqueCustomers + ' عميل';
            
            displaySalesDetails('daily', dailyInvoices);
        }
        
        // دالة لتحميل التقرير الأسبوعي
        function loadWeeklyReport() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 7);
            
            const weeklyInvoices = invoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= startOfWeek && invoiceDate < endOfWeek;
            });
            
            const totalSales = weeklyInvoices.reduce((sum, invoice) => sum + invoice.grandTotal, 0);
            const totalProducts = weeklyInvoices.reduce((sum, invoice) => sum + invoice.products.length, 0);
            const totalUnits = weeklyInvoices.reduce((sum, invoice) => sum + invoice.products.reduce((prodSum, product) => prodSum + product.quantity, 0), 0);
            const uniqueCustomers = [...new Set(weeklyInvoices.map(invoice => invoice.client.name))].length;
            const avgDaily = weeklyInvoices.length > 0 ? totalSales / 7 : 0;
            
            document.getElementById('weekly-total-sales').textContent = totalSales.toFixed(2) + ' دينار';
            document.getElementById('weekly-invoices-count').textContent = weeklyInvoices.length + ' فاتورة';
            document.getElementById('weekly-products-sold').textContent = totalProducts + ' منتج';
            document.getElementById('weekly-units-sold').textContent = totalUnits + ' وحدة';
            document.getElementById('weekly-avg-daily').textContent = avgDaily.toFixed(2) + ' دينار';
            document.getElementById('weekly-customers-count').textContent = uniqueCustomers + ' عميل';
            
            displaySalesDetails('weekly', weeklyInvoices);
        }
        
        // دالة لتحميل التقرير الشهري
        function loadMonthlyReport() {
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            const monthlyInvoices = invoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= startOfMonth && invoiceDate <= endOfMonth;
            });
            
            const totalSales = monthlyInvoices.reduce((sum, invoice) => sum + invoice.grandTotal, 0);
            const totalProducts = monthlyInvoices.reduce((sum, invoice) => sum + invoice.products.length, 0);
            const totalUnits = monthlyInvoices.reduce((sum, invoice) => sum + invoice.products.reduce((prodSum, product) => prodSum + product.quantity, 0), 0);
            const uniqueCustomers = [...new Set(monthlyInvoices.map(invoice => invoice.client.name))].length;
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const avgDaily = monthlyInvoices.length > 0 ? totalSales / daysInMonth : 0;
            
            document.getElementById('monthly-total-sales').textContent = totalSales.toFixed(2) + ' دينار';
            document.getElementById('monthly-invoices-count').textContent = monthlyInvoices.length + ' فاتورة';
            document.getElementById('monthly-products-sold').textContent = totalProducts + ' منتج';
            document.getElementById('monthly-units-sold').textContent = totalUnits + ' وحدة';
            document.getElementById('monthly-avg-daily').textContent = avgDaily.toFixed(2) + ' دينار';
            document.getElementById('monthly-customers-count').textContent = uniqueCustomers + ' عميل';
            
            displaySalesDetails('monthly', monthlyInvoices);
        }
        
        // دالة لتحميل التقرير السنوي
        function loadAnnualReport() {
            const today = new Date();
            const currentYear = today.getFullYear();
            const startOfYear = new Date(currentYear, 0, 1);
            const endOfYear = new Date(currentYear, 11, 31);
            
            const annualInvoices = invoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= startOfYear && invoiceDate <= endOfYear;
            });
            
            const totalSales = annualInvoices.reduce((sum, invoice) => sum + invoice.grandTotal, 0);
            const totalInvoices = annualInvoices.length;
            const uniqueCustomers = [...new Set(annualInvoices.map(invoice => invoice.client.name))].length;
            const monthlyAvg = totalSales / 12;
            
            const monthlySales = {};
            for (let i = 0; i < 12; i++) monthlySales[i] = 0;
            
            annualInvoices.forEach(invoice => {
                const month = new Date(invoice.date).getMonth();
                monthlySales[month] += invoice.grandTotal;
            });
            
            let bestMonth = 0;
            let bestMonthSales = 0;
            for (let i = 0; i < 12; i++) {
                if (monthlySales[i] > bestMonthSales) {
                    bestMonthSales = monthlySales[i];
                    bestMonth = i;
                }
            }
            
            const monthNames = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            
            document.getElementById('annual-total-sales').textContent = totalSales.toFixed(2) + ' دينار';
            document.getElementById('annual-invoices-count').textContent = totalInvoices + ' فاتورة';
            document.getElementById('best-month-sales').textContent = bestMonthSales.toFixed(2) + ' دينار';
            document.getElementById('best-month-name').textContent = monthNames[bestMonth];
            document.getElementById('monthly-avg-sales').textContent = monthlyAvg.toFixed(2) + ' دينار';
            document.getElementById('annual-customers-count').textContent = uniqueCustomers + ' عميل';
            
            const monthlyChart = document.getElementById('monthly-chart');
            monthlyChart.innerHTML = '';
            
            const maxSales = Math.max(...Object.values(monthlySales));
            for (let i = 0; i < 12; i++) {
                const monthBar = document.createElement('div');
                monthBar.className = 'month-bar';
                const height = maxSales > 0 ? (monthlySales[i] / maxSales) * 100 : 0;
                monthBar.innerHTML = `
                    <div class="month-value">${monthlySales[i].toFixed(2)} دينار</div>
                    <div class="bar" style="height: ${height}%;"></div>
                    <div class="month-name">${monthNames[i]}</div>
                `;
                monthlyChart.appendChild(monthBar);
            }
            
            displaySalesDetails('annual', annualInvoices);
        }
        
        // دالة لعرض تفاصيل المبيعات مع التقسيم للصفحات
        function displaySalesDetails(reportType, invoicesList) {
            const containerId = `${reportType}-sales-details`;
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (invoicesList.length === 0) {
                container.innerHTML = '<p>لا توجد مبيعات في هذه الفترة</p>';
                return;
            }
            
            const totalPages = Math.ceil(invoicesList.length / salesPerPage);
            const startIndex = (currentSalesPage - 1) * salesPerPage;
            const endIndex = startIndex + salesPerPage;
            const currentPageInvoices = invoicesList.slice(startIndex, endIndex);
            
            let tableHTML = `
                <table class="sales-details-table">
                    <thead>
                        <tr>
                            <th>رقم الفاتورة</th>
                            <th>التاريخ</th>
                            <th>اسم العميل</th>
                            <th>اسم المنتج</th>
                            <th>الكمية</th>
                            <th>سعر الوحدة</th>
                            <th>المجموع</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            currentPageInvoices.forEach(invoice => {
                invoice.products.forEach(product => {
                    tableHTML += `
                        <tr>
                            <td>${invoice.id}</td>
                            <td>${new Date(invoice.date).toLocaleDateString('ar-EG')}</td>
                            <td>${invoice.client.name}</td>
                            <td>${product.productName}</td>
                            <td>${product.quantity}</td>
                            <td>${product.price.toFixed(2)} دينار</td>
                            <td>${product.total.toFixed(2)} دينار</td>
                        </tr>
                    `;
                });
            });
            
            tableHTML += '</tbody></table>';
            
            if (totalPages > 1) {
                let paginationHTML = '<div class="pagination">';
                for (let i = 1; i <= totalPages; i++) {
                    paginationHTML += `<button class="${i === currentSalesPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
                }
                paginationHTML += '</div>';
                tableHTML += paginationHTML;
                
                container.innerHTML = tableHTML;
                
                container.querySelectorAll('.pagination button').forEach(button => {
                    button.addEventListener('click', function() {
                        currentSalesPage = parseInt(this.getAttribute('data-page'));
                        displaySalesDetails(reportType, invoicesList);
                    });
                });
            } else {
                container.innerHTML = tableHTML;
            }
        }
        
        // دالة لطباعة التقارير
        function printReport(reportType) {
            const printWindow = window.open('', '_blank');
            const reportTitle = getReportTitle(reportType);
            
            let reportContent = '';
            if (reportType === 'daily') {
                reportContent = document.getElementById('daily-report').innerHTML;
            } else if (reportType === 'weekly') {
                reportContent = document.getElementById('weekly-report').innerHTML;
            } else if (reportType === 'monthly') {
                reportContent = document.getElementById('monthly-report').innerHTML;
            } else if (reportType === 'annual') {
                reportContent = document.getElementById('annual-report').innerHTML;
            }
            
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>${reportTitle}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px double #000; padding: 20px; }
                        .header h1 { margin: 0; font-size: 32px; color: #2c3e50; }
                        .header h2 { margin: 10px 0; font-size: 24px; color: #34495e; }
                        .english-title { font-size: 20px; color: #7f8c8d; }
                        .report-content { margin: 20px 0; }
                        .summary-card { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>مصنع أحمد العاروري</h1>
                        <h2>لصناعة أكسسوارات الديكور</h2>
                        <div class="english-title">FACTORY FOR DECORATION ACCESSORIES</div>
                        <h3>${reportTitle}</h3>
                        <p>تاريخ الطباعة: ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>
                    <div class="report-content">
                        ${reportContent}
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        // دالة للحصول على عنوان التقرير
        function getReportTitle(reportType) {
            switch(reportType) {
                case 'daily': return 'تقرير المبيعات اليومي';
                case 'weekly': return 'تقرير المبيعات الأسبوعي';
                case 'monthly': return 'تقرير المبيعات الشهري';
                case 'annual': return 'تقرير المبيعات السنوي';
                default: return 'تقرير';
            }
        }
    </script>
</body>
</html>